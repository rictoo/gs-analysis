<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Generations Study</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="generations_files/libs/clipboard/clipboard.min.js"></script>
<script src="generations_files/libs/quarto-html/quarto.js"></script>
<script src="generations_files/libs/quarto-html/popper.min.js"></script>
<script src="generations_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="generations_files/libs/quarto-html/anchor.min.js"></script>
<link href="generations_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="generations_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="generations_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="generations_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="generations_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Generations Study</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="importing-packages-and-setup" class="level2">
<h2 class="anchored" data-anchor-id="importing-packages-and-setup">Importing packages and setup</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggsurvfit)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#options(max.print=100)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="global-variables" class="level2">
<h2 class="anchored" data-anchor-id="global-variables">Global variables</h2>
<p>Directory hidden (due to being public)</p>
</section>
<section id="importing-data" class="level2">
<h2 class="anchored" data-anchor-id="importing-data">Importing data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cancer events:</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>dataset_ca <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(dataset_dir, <span class="st">"RDSCaSummary_V1.csv"</span>), <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">"NULL"</span>, <span class="st">""</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Risk factors:</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>dataset_rf <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(dataset_dir, <span class="st">"RDSRiskFactors.csv"</span>), <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">"NULL"</span>, <span class="st">""</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Deaths:</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#dataset_deaths &lt;- read.csv(paste0(dataset_dir, "Deaths.csv)"))</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Collections:</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>dataset_collections <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(dataset_dir, <span class="st">"RDSCollections_v1_Full.csv"</span>), <span class="at">na.strings =</span> <span class="st">"NULL"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exploration" class="level2">
<h2 class="anchored" data-anchor-id="exploration">Exploration</h2>
<section id="riskfactors" class="level3">
<h3 class="anchored" data-anchor-id="riskfactors">RiskFactors</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#colnames(dataset_riskfactors) &lt;- tolower(colnames(dataset_riskfactors))</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dataset_rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exploration (early code)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">5</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution of age at entry</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dataset_rf<span class="sc">$</span>AgeatEntry, <span class="at">main=</span><span class="st">"Distribution of 'ageatentry'"</span>, <span class="at">col=</span><span class="st">'tomato'</span>, <span class="at">xlab =</span> <span class="st">'Age'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution of FHx of Breast ca</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>table_data <span class="ot">&lt;-</span> <span class="fu">table</span>(dataset_rf<span class="sc">$</span>fambrca)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">barplot</span>(table_data, <span class="at">main=</span><span class="st">"Distribution of Family hx of Breast ca"</span>, <span class="at">xlab=</span><span class="st">'Family hx'</span>, <span class="at">ylab=</span><span class="st">'Frequency'</span>, <span class="at">col=</span><span class="st">'tomato'</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(table_data)<span class="sc">*</span><span class="fl">1.2</span>))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span>bp, <span class="at">y=</span>table_data, <span class="at">labels=</span><span class="fu">paste0</span>(<span class="fu">round</span>(table_data<span class="sc">/</span><span class="fu">sum</span>(table_data)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">'%'</span>), <span class="at">pos=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">'black'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution of Ethnicity ('ethnew5')</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>table_data <span class="ot">&lt;-</span> <span class="fu">table</span>(dataset_rf<span class="sc">$</span>ethnew5)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">barplot</span>(table_data, <span class="at">main=</span><span class="st">"Distribution of Ethnicity ('ethnew5')"</span>, <span class="at">xlab=</span><span class="st">'Ethnicity'</span>, <span class="at">ylab=</span><span class="st">'Frequency'</span>, <span class="at">col=</span><span class="st">'tomato'</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(table_data)<span class="sc">*</span><span class="fl">1.2</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span>bp, <span class="at">y=</span>table_data, <span class="at">labels=</span><span class="fu">paste0</span>(<span class="fu">round</span>(table_data<span class="sc">/</span><span class="fu">sum</span>(table_data)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">'%'</span>), <span class="at">pos=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">'black'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution of BMI at recruitment</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclusion of BMI 999 and 989 (? NA)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dataset_rf<span class="sc">$</span>bodysizebminow[<span class="sc">!</span>dataset_rf<span class="sc">$</span>bodysizebminow <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">999</span>, <span class="dv">989</span>)], <span class="at">main=</span><span class="st">"Distribution of BMI at recruitment ('bodysizebminow')"</span>, <span class="at">col=</span><span class="st">'tomato'</span>, <span class="at">xlab =</span> <span class="st">'BMI'</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-5-4.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution of Smoking status ('R1smokingstatus')</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>table_data <span class="ot">&lt;-</span> <span class="fu">table</span>(dataset_rf<span class="sc">$</span>R1smokingstatus) <span class="co"># Stop scientific notation on y axis</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">barplot</span>(table_data, <span class="at">main=</span><span class="st">"Distribution of Smoking status ('R1smokingstatus')"</span>, <span class="at">xlab=</span><span class="st">'Smoking status'</span>, <span class="at">ylab=</span><span class="st">'Frequency'</span>, <span class="at">col=</span><span class="st">'tomato'</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(table_data)<span class="sc">*</span><span class="fl">1.2</span>))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span>bp, <span class="at">y=</span>table_data, <span class="at">labels=</span><span class="fu">paste0</span>(<span class="fu">round</span>(table_data<span class="sc">/</span><span class="fu">sum</span>(table_data)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">'%'</span>), <span class="at">pos=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">'black'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-5-5.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># smokingstartage</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dataset_rf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(smokingstartage <span class="sc">&lt;</span> <span class="dv">500</span>), <span class="fu">aes</span>(<span class="at">x=</span>smokingstartage)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">'darkred'</span>, <span class="at">fill=</span><span class="st">'tomato'</span>, <span class="at">binwidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Start age"</span>, <span class="at">y=</span><span class="st">"Count"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Smoking start age count"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-5-6.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># smokingstopage</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dataset_rf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(smokingstopage <span class="sc">&lt;</span> <span class="dv">500</span>), <span class="fu">aes</span>(<span class="at">x=</span>smokingstopage)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">'darkred'</span>, <span class="at">fill=</span><span class="st">'tomato'</span>, <span class="at">binwidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Stop age"</span>, <span class="at">y=</span><span class="st">"Count"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Smoking stop age count"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-5-7.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution of SES ('ses')</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>table_data <span class="ot">&lt;-</span> <span class="fu">table</span>(dataset_rf<span class="sc">$</span>ses) <span class="co"># Stop scientific notation on y axis</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">barplot</span>(table_data, <span class="at">main=</span><span class="st">"Distribution of SES ('ses')"</span>, <span class="at">xlab=</span><span class="st">'SES'</span>, <span class="at">ylab=</span><span class="st">'Frequency'</span>, <span class="at">col=</span><span class="st">'tomato'</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(table_data)<span class="sc">*</span><span class="fl">1.2</span>))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span>bp, <span class="at">y=</span>table_data, <span class="at">labels=</span><span class="fu">paste0</span>(<span class="fu">round</span>(table_data<span class="sc">/</span><span class="fu">sum</span>(table_data)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">'%'</span>), <span class="at">pos=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">'black'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-5-8.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="casummary" class="level3">
<h3 class="anchored" data-anchor-id="casummary">CaSummary</h3>
</section>
</section>
<section id="pre-processing-and-sanity-checking" class="level2">
<h2 class="anchored" data-anchor-id="pre-processing-and-sanity-checking">Pre-processing and sanity checking</h2>
<section id="general-information" class="level3">
<h3 class="anchored" data-anchor-id="general-information">General information</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print number of rows</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'There are '</span>, <span class="fu">nrow</span>(dataset_rf), <span class="st">' rows in the risk factor dataset'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "There are 116664 rows in the risk factor dataset"</code></pre>
</div>
</div>
</section>
<section id="identification-numbers" class="level3">
<h3 class="anchored" data-anchor-id="identification-numbers">Identification numbers</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For risk factor dataset:</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the number of correctly-formatted IDs</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>TCode_regex <span class="ot">&lt;-</span> <span class="st">'T</span><span class="sc">\\</span><span class="st">d{3}[A-Z]</span><span class="sc">\\</span><span class="st">d{3}'</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>cnt_crct_ids <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">grepl</span>(TCode_regex, dataset_rf<span class="sc">$</span>TCode))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'There are '</span>, cnt_crct_ids, <span class="st">' correctly-formatted IDs in risk factor dataset'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "There are 116664 correctly-formatted IDs in risk factor dataset"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the number of empty IDs</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>empty_ids <span class="ot">&lt;-</span> <span class="fu">is.na</span>(dataset_rf<span class="sc">$</span>TCode)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'There are '</span>, <span class="fu">ifelse</span>(<span class="fu">sum</span>(empty_ids) <span class="sc">==</span> <span class="dv">0</span>, <span class="st">'no'</span>, <span class="fu">sum</span>(empty_ids)), <span class="st">' empty IDs in risk factor dataset, which will now be removed'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "There are no empty IDs in risk factor dataset, which will now be removed"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dataset_rf <span class="ot">&lt;-</span> dataset_rf[<span class="sc">!</span>empty_ids,]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Counting and removing duplicate IDs</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>dupl_ids <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">duplicated</span>(dataset_rf<span class="sc">$</span>TCode))</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(dupl_ids) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">'There are no duplicate IDs'</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'There are '</span>, <span class="fu">length</span>(dupl_ids), <span class="st">' duplicate IDs in risk factor dataset, which will now be removed'</span>))</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  dataset_rf <span class="ot">&lt;-</span> dataset_rf[<span class="sc">-</span>dupl_ids,]</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "There are no duplicate IDs"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For cancer summary dataset:</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the number of correctly-formatted IDs</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>TCode_regex <span class="ot">&lt;-</span> <span class="st">'T</span><span class="sc">\\</span><span class="st">d{3}[A-Z]</span><span class="sc">\\</span><span class="st">d{3}'</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>cnt_crct_ids <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">grepl</span>(TCode_regex, dataset_ca<span class="sc">$</span>tcode))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'There are '</span>, cnt_crct_ids, <span class="st">' correctly-formatted IDs in cancer summary dataset'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "There are 38892 correctly-formatted IDs in cancer summary dataset"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the number of empty IDs</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>empty_ids <span class="ot">&lt;-</span> <span class="fu">is.na</span>(dataset_ca<span class="sc">$</span>tcode)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'There are '</span>, <span class="fu">ifelse</span>(<span class="fu">sum</span>(empty_ids) <span class="sc">==</span> <span class="dv">0</span>, <span class="st">'no'</span>, <span class="fu">sum</span>(empty_ids)), <span class="st">' empty IDs in cancer summary dataset, which will now be removed'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "There are 5 empty IDs in cancer summary dataset, which will now be removed"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dataset_ca <span class="ot">&lt;-</span> dataset_ca[<span class="sc">!</span>empty_ids,]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># For collections dataset:</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the number of correctly-formatted IDs</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>TCode_regex <span class="ot">&lt;-</span> <span class="st">'T</span><span class="sc">\\</span><span class="st">d{3}[A-Z]</span><span class="sc">\\</span><span class="st">d{3}'</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>cnt_crct_ids <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">grepl</span>(TCode_regex, dataset_collections<span class="sc">$</span>TCode))</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'There are '</span>, cnt_crct_ids, <span class="st">' correctly-formatted IDs in risk factor dataset'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "There are 116664 correctly-formatted IDs in risk factor dataset"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the number of empty IDs</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>empty_ids <span class="ot">&lt;-</span> <span class="fu">is.na</span>(dataset_collections<span class="sc">$</span>TCode)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'There are '</span>, <span class="fu">ifelse</span>(<span class="fu">sum</span>(empty_ids) <span class="sc">==</span> <span class="dv">0</span>, <span class="st">'no'</span>, <span class="fu">sum</span>(empty_ids)), <span class="st">' empty IDs in risk factor dataset, which will now be removed'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "There are no empty IDs in risk factor dataset, which will now be removed"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dataset_collections <span class="ot">&lt;-</span> dataset_collections[<span class="sc">!</span>empty_ids,]</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Counting and removing duplicate IDs</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>dupl_ids <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">duplicated</span>(dataset_collections<span class="sc">$</span>TCode))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(dupl_ids) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">'There are no duplicate IDs'</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'There are '</span>, <span class="fu">length</span>(dupl_ids), <span class="st">' duplicate IDs in risk factor dataset, which will now be removed'</span>))</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  datas</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "There are no duplicate IDs"</code></pre>
</div>
</div>
</section>
<section id="dates" class="level3">
<h3 class="anchored" data-anchor-id="dates">Dates</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Assumes dates are in YMD format.</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Columns with date information:</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># RiskFactor dataframe: DOB, EntryDate, datedueQ, fupca_start, fupca_end, pregdate_[1:9], etc.</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fractional year difference between dates</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># date1 = First date, chronologically</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># date2 = Second date, chronologically</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Takes every calendar year to be one unit</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Everything trailing after that is calculated as an additional fraction, according to the number of days in that year (ie., factoring in leap years)</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>year_diff <span class="ot">&lt;-</span> <span class="cf">function</span>(date1, date2) {</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert the dates to Date objects</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  date1 <span class="ot">&lt;-</span> <span class="fu">ymd</span>(date1)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  date2 <span class="ot">&lt;-</span> <span class="fu">ymd</span>(date2)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  years <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(date1) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(date2), </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">time_length</span>(<span class="fu">interval</span>(date1, date2), <span class="st">"year"</span>), </span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>                  <span class="cn">NA</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Demonstrating how lubridate handles leap years</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co">#test_dob1 &lt;- '2017-01-01'</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="co">#test_dob2 &lt;- '2018-01-01'</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="co">#years &lt;- year_diff(test_dob1, test_dob2)</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="co">#print(years)</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Risk factor dataset</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>dataset_rf <span class="ot">&lt;-</span> dataset_rf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ADOB_F =</span> <span class="fu">as.Date</span>(<span class="fu">ymd_hms</span>(ADOB_F)), </span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">EntryDate_F =</span> <span class="fu">as.Date</span>(<span class="fu">ymd_hms</span>(EntryDate_F)),</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">datedueQ_F =</span> <span class="fu">as.Date</span>(<span class="fu">ymd_hms</span>(datedueQ_F)),</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">fupca_start_F =</span> <span class="fu">as.Date</span>(<span class="fu">ymd_hms</span>(fupca_start_F)),</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">fupca_end_F =</span> <span class="fu">as.Date</span>(<span class="fu">ymd_hms</span>(fupca_end_F))) <span class="sc">%&gt;%</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">'pregdate_'</span>), \(x) <span class="fu">as.Date</span>(<span class="fu">ymd_hms</span>(x))))</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Cancer summary dataset</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>dataset_ca <span class="ot">&lt;-</span> dataset_ca <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">diagdate_f =</span> <span class="fu">as.Date</span>(<span class="fu">ymd_hms</span>(diagdate_f)))</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Collections dataset</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>dataset_collections <span class="ot">&lt;-</span> dataset_collections <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">QR1_date_f =</span> <span class="fu">as.Date</span>(<span class="fu">ymd_hms</span>(QR1_date_f)), </span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">QR2_date_f =</span> <span class="fu">as.Date</span>(<span class="fu">ymd_hms</span>(QR2_date_f)),</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">QR3_date_f =</span> <span class="fu">as.Date</span>(<span class="fu">ymd_hms</span>(QR3_date_f)),</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">QR4_date_f =</span> <span class="fu">as.Date</span>(<span class="fu">ymd_hms</span>(QR4_date_f)))</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Merging these questionnaire return dates with the risk factor data</span></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>dataset_rf <span class="ot">&lt;-</span> dataset_rf <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(<span class="at">by=</span><span class="st">"TCode"</span>, dataset_collections <span class="sc">%&gt;%</span> <span class="fu">select</span>(TCode, QR1_date_f, QR2_date_f, QR3_date_f, QR4_date_f))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="remove-prevalent-unreturned-questionnaires-and-prepare-survival-data" class="level3">
<h3 class="anchored" data-anchor-id="remove-prevalent-unreturned-questionnaires-and-prepare-survival-data">Remove prevalent, unreturned questionnaires, and prepare survival data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ? Necessary to implement sanity checking for dates of diagnosis &lt; DOB</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Arguments:</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rf_df: Risk factor dataframe</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ca_df: Cancer event dataframe</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ca_icdt: String vector for the ICD codes to exclude if prevalent. If 'all', then all prevalent cancer cases will be excluded.</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Returns: An updated risk factor dataframe with the prevalent cases removed</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>exclude_prevalent <span class="ot">&lt;-</span> <span class="cf">function</span>(rf_df, ca_df, ca_icdt, <span class="at">regex =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Support input of either regex or a vector of strings</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>regex) {</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    ca_icdt_regex <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"^("</span>, <span class="fu">paste</span>(ca_icdt, <span class="at">collapse =</span> <span class="st">"|"</span>), <span class="st">")"</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    ca_icdt_regex <span class="ot">&lt;-</span> ca_icdt</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  ca_rf_merged <span class="ot">&lt;-</span> ca_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(tcode, diagdate_f, ICDt) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(rf_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(TCode, ADOB_F, fupca_start_F), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"tcode"</span> <span class="ot">=</span> <span class="st">"TCode"</span>))</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">'all'</span> <span class="sc">%in%</span> ca_icdt) {</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    tcodes_to_exclude <span class="ot">&lt;-</span> ca_rf_merged <span class="sc">%&gt;%</span> <span class="fu">filter</span>(diagdate_f <span class="sc">&lt;=</span> fupca_start_F) <span class="sc">%&gt;%</span> </span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(tcode) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">pull</span>(tcode) </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    tcodes_to_exclude <span class="ot">&lt;-</span> ca_rf_merged <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(ca_icdt_regex, ICDt, <span class="at">perl=</span><span class="cn">TRUE</span>) <span class="sc">&amp;</span> diagdate_f <span class="sc">&lt;=</span> fupca_start_F) <span class="sc">%&gt;%</span> <span class="co"># Prevalent = On (to remove diagnoses on the day of recruitment) OR before</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(tcode) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">pull</span>(tcode)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(rf_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>(TCode <span class="sc">%in%</span> tcodes_to_exclude)))</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop prevalent cases</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="co">#dataset_rf &lt;- exclude_prevalent(dataset_rf, dataset_ca, c('C50','174','D051','D059','2330'))</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>dataset_rf <span class="ot">&lt;-</span> <span class="fu">exclude_prevalent</span>(dataset_rf, dataset_ca, <span class="st">"^(C(?!44)[0-9]+|1(?!73)[0-9]+|20|D051|D059|2330|C50|174)"</span>, <span class="at">regex=</span><span class="cn">TRUE</span>)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop those with unknown follow-up end times (the majority of which are due to unreturned questionnaire)</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>dataset_rf <span class="ot">&lt;-</span> dataset_rf[<span class="sc">!</span><span class="fu">is.na</span>(dataset_rf<span class="sc">$</span>fupca_end_F),]</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop those outside of cohort window (fupca_end_reason == 99)</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>dataset_rf <span class="ot">&lt;-</span> dataset_rf[dataset_rf<span class="sc">$</span>fupca_end_reason <span class="sc">!=</span> <span class="dv">99</span>,]</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop those with a follow-up end time equal to follow-up start time (? No time spent in study)</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>dataset_rf <span class="ot">&lt;-</span> dataset_rf[dataset_rf<span class="sc">$</span>fupca_start_F <span class="sc">!=</span> dataset_rf<span class="sc">$</span>fupca_end_F,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Censoring criteria is minimum of: Event of interest, censoring event (e.g., any invasive cancer), follow-up time ended.</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Per Michael's definitions:</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define event of interest (e.g., breast cancer c('C50', '174', 'D051', 'D059', '2330'))</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define censoring event (union of event of interest + c('C' [except C44], '1' [except 173], '20', 'D051', 'D059', '2330'))</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Return: Each row in rf will have: tcode, event (0, 1), time contributed (ie., time to event or censored)</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>prepare_survival_data <span class="ot">&lt;-</span> <span class="cf">function</span>(rf_df, ca_df, event_icdt, cens_icdt, <span class="at">regex =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Support input of either regex or a vector of strings</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>regex) {</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    event_icdt_regex <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"^("</span>, <span class="fu">paste</span>(event_icdt, <span class="at">sep =</span> <span class="st">"|"</span>), <span class="st">")"</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    cens_icdt_regex <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"^("</span>, <span class="fu">paste</span>(cens_icdt, <span class="at">sep =</span> <span class="st">"|"</span>), <span class="st">")"</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    event_icdt_regex <span class="ot">&lt;-</span> event_icdt</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    cens_icdt_regex <span class="ot">&lt;-</span> cens_icdt</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  ca_rf_merged <span class="ot">&lt;-</span> rf_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(TCode, ADOB_F, fupca_start_F, fupca_end_F) <span class="sc">%&gt;%</span> </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(ca_df <span class="sc">%&gt;%</span>  <span class="fu">select</span>(tcode, ICDt, diagdate_f, Reginfo_Clusterino, Report_Cluster) <span class="sc">%&gt;%</span> </span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">Reginfo_Clusterino =</span> <span class="fu">ifelse</span>(Reginfo_Clusterino <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">999</span>, Reginfo_Clusterino),</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">Report_Cluster     =</span> <span class="fu">ifelse</span>(Report_Cluster <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">999</span>, Report_Cluster)), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"TCode"</span> <span class="ot">=</span> <span class="st">"tcode"</span>))</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pre-calculate event and censor indicators (? faster)</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  ca_rf_merged <span class="ot">&lt;-</span> ca_rf_merged <span class="sc">%&gt;%</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_event =</span> <span class="fu">grepl</span>(event_icdt_regex, ICDt, <span class="at">perl =</span> <span class="cn">TRUE</span>) <span class="sc">&amp;</span> diagdate_f <span class="sc">&gt;=</span> fupca_start_F <span class="sc">&amp;</span> diagdate_f <span class="sc">&lt;=</span> fupca_end_F,</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_censor =</span> <span class="fu">grepl</span>(cens_icdt_regex, ICDt, <span class="at">perl =</span> <span class="cn">TRUE</span>) <span class="sc">&amp;</span> diagdate_f <span class="sc">&gt;=</span> fupca_start_F <span class="sc">&amp;</span> diagdate_f <span class="sc">&lt;=</span> fupca_end_F</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create survival data dataframe</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>  survival_data <span class="ot">&lt;-</span> ca_rf_merged <span class="sc">%&gt;%</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(diagdate_f, Reginfo_Clusterino, Report_Cluster) <span class="sc">%&gt;%</span>  </span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(TCode) <span class="sc">%&gt;%</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">earliest_event_date =</span> <span class="fu">first</span>(diagdate_f[is_event]),</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">earliest_censor_date =</span> <span class="fu">first</span>(diagdate_f[is_censor]),</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">event =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(earliest_event_date) <span class="sc">&amp;&amp;</span> (<span class="fu">is.na</span>(earliest_censor_date) <span class="sc">||</span> earliest_event_date <span class="sc">&lt;=</span> earliest_censor_date), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">c_date =</span> <span class="fu">as.Date</span>(<span class="fu">pmin</span>(<span class="fu">ifelse</span>(event <span class="sc">==</span> <span class="dv">1</span>, earliest_event_date, <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(earliest_censor_date), earliest_censor_date, fupca_end_F)))),</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">ADOB_F =</span> <span class="fu">first</span>(ADOB_F),</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">fupca_start_F =</span> <span class="fu">first</span>(fupca_start_F),</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>      <span class="co">#c_age = year_diff(first(DOB), c_date),</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>      <span class="co">#fup_years = year_diff(first(fupca_start), c_age)</span></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>  survival_data<span class="sc">$</span>fupca_start_age <span class="ot">&lt;-</span> <span class="fu">year_diff</span>(survival_data<span class="sc">$</span>ADOB_F, survival_data<span class="sc">$</span>fupca_start_F)</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>  survival_data<span class="sc">$</span>c_age <span class="ot">&lt;-</span> <span class="fu">year_diff</span>(survival_data<span class="sc">$</span>ADOB_F, survival_data<span class="sc">$</span>c_date)</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">#survival_data$fup_years &lt;- year_diff(survival_data$fupca_start_F, survival_data$c_date)</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(survival_data)</span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Define patterns to match to label events and censoring events appropriately</span></span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>event_regex <span class="ot">&lt;-</span> <span class="st">"^(C50|174|D051|D059|2330)"</span> <span class="co"># identify invasive or DCIS-breast cancer</span></span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>cens_regex <span class="ot">&lt;-</span> <span class="st">"^(C(?!44)[0-9]+|1(?!73)[0-9]+|20|D051|D059|2330|C50|174)"</span> <span class="co"># any invasive cancer (including breast cancer) and DCIS-breast cancer (exclude NMSC)</span></span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: ? Include some pre-sets (e.g., for ovarian ca, or just invasive breast ca, etc.)</span></span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>survival_data <span class="ot">&lt;-</span> <span class="fu">prepare_survival_data</span>(dataset_rf, dataset_ca, event_regex, cens_regex, <span class="at">regex =</span> <span class="cn">TRUE</span>) <span class="do">## complete</span></span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(survival_data<span class="sc">$</span>fupca_start_age<span class="sc">*</span><span class="dv">365</span>, <span class="at">main =</span> <span class="st">'Histogram of follow-up start ages (in days)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(survival_data<span class="sc">$</span>c_age<span class="sc">*</span><span class="dv">365</span>, <span class="at">main=</span><span class="st">'Histogram of censored ages (in days)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table of number of events</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(survival_data<span class="sc">$</span>event, <span class="at">useNA=</span><span class="st">"always"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     0      1   &lt;NA&gt; 
101061   3633      0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Other than prevalents not being removed in Michael's R code and two discrepencies, the number of events/censors are identical:</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] "T354F523" "T413E738" are the two IDs that are different (bar prevalents) - Both were excluded from my analysis because they have NA fupca_end dates.</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: ? </span><span class="al">TODO</span><span class="co">: Implement reason for censoring/end of follow-up </span><span class="al">TODO</span><span class="co">: Implement breast cancer morphology labeling (ductal, mucinous, etc.)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="risk-factors" class="level3">
<h3 class="anchored" data-anchor-id="risk-factors">Risk factors</h3>
<section id="configuration" class="level4">
<h4 class="anchored" data-anchor-id="configuration">Configuration</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify missing/unknown labels</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify accepted range, lower and upper bounds are inclusive</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorical variables</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Categorical (to turn into R factors)</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Continuous -&gt; Categorical: Specify range of values per band.</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The first of the named categories will be set as the reference level.</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuration list:</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The name of each element is the name of the pre-processed variable (ie,. the variable to process)</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 'varname': the name of the post-processed variable.</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 'realname': the real-world name of the variable.</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 'bands': for conversion of a continuous to a categorical variable.</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 'exp_range': the expected range of values for a continuous variable, values outside of this range will be set to NA</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 'unknown': the values the pre-processed variable takes on when there is missing information, these will be set to NA</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 'categories': the labels for the levels for a categorical variable.</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>rf_config <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Age at entry</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">'AgeatEntry'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'ageentrygrp'</span>,</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Age at entry'</span>,</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">bands =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">35</span>, <span class="dv">45</span>, <span class="dv">55</span>, <span class="dv">65</span>, <span class="dv">75</span>, <span class="dv">102</span>) <span class="co"># Michael</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>         <span class="co">#  c(-Inf, 35, 50, 60, 79, +Inf) # Louise ('1st grouping'): </span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>         <span class="co">#  c(16, 35, 50, 60, 102) # Louise ('2nd grouping')</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Height</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">'bodysizeht'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'bodysizeht'</span>,</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Height'</span>,</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">999</span>, <span class="dv">989</span>, <span class="dv">888</span>), <span class="co"># Michael</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>                                    <span class="co"># Louise keeps 777/888/999 intact</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">140</span>, <span class="dv">220</span>) <span class="co"># Michael</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># exp_range = c(140, 300) # Louise</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">'bodysizeht'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'heightgrp'</span>,</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Height (group)'</span>,</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">999</span>, <span class="dv">989</span>, <span class="dv">888</span>),</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">bands =</span> <span class="fu">c</span>(<span class="dv">140</span>, <span class="dv">160</span>, <span class="dv">165</span>, <span class="dv">170</span>, <span class="dv">175</span>, <span class="dv">220</span>) <span class="co"># Michael</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">#bands = c(140, 165, 300) # Louise</span></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>  <span class="st">'bodysizeht20'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'bodysizeht20'</span>,</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Height at age 20'</span>,</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">999</span>, <span class="dv">989</span>, <span class="dv">888</span>),</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">140</span>, <span class="dv">220</span>) <span class="co"># Michael</span></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>  <span class="st">'bodysizeht20'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'height20grp'</span>,</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Height at age 20 (group)'</span>,</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">999</span>, <span class="dv">989</span>, <span class="dv">888</span>),</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">bands =</span> <span class="fu">c</span>(<span class="dv">140</span>, <span class="dv">160</span>, <span class="dv">165</span>, <span class="dv">170</span>, <span class="dv">175</span>, <span class="dv">220</span>) <span class="co"># Michael</span></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Weight</span></span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>  <span class="st">'bodysizewt20'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'bodysizewt20'</span>,</span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Weight at age 20'</span>,</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">999</span>),</span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">200</span>) <span class="co"># Michael</span></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a>  <span class="st">'bodysizewt20'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'weight20grp'</span>,</span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Weight at age 20 (group)'</span>,</span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">999</span>),</span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">bands =</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">55</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">200</span>) <span class="co"># Michael</span></span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'bodysizewtnow' = list(</span></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  varname = 'bodysizewtnow',</span></span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  unknown = c(NA, 999, 989, 888),</span></span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  exp_range = c(10, 200)</span></span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a>  <span class="co">#),</span></span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># BMI</span></span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a>  <span class="st">'bodysizebminow'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'bminowgrp'</span>,</span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'BMI (group)'</span>,</span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">999</span>, <span class="dv">989</span>, <span class="dv">888</span>),</span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">50</span>), <span class="co"># Michael</span></span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a>    <span class="co">#bands = c(-Inf, 10, seq(18.5, 25, 2.5), 50, +Inf), # Michael</span></span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">bands =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">100</span>), <span class="co"># Louise</span></span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'&lt; 20'</span>, <span class="st">'20-24'</span>, <span class="st">'&gt;=25'</span>)</span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a>  <span class="st">'bodysizebminow'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'bodysizebminow'</span>,</span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'BMI'</span>,</span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">999</span>, <span class="dv">989</span>, <span class="dv">888</span>),</span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">50</span>)</span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R2bodysizebmi'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'R2bodysizebmi'</span>,</span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'BMI @ R2'</span>,</span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">999</span>, <span class="dv">989</span>, <span class="dv">888</span>),</span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">50</span>)</span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R4bodysizebmi'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'R2bodysizebmi'</span>,</span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'BMI @ R2'</span>,</span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">999</span>, <span class="dv">989</span>, <span class="dv">888</span>),</span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">50</span>)</span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a>  <span class="st">'bodysizebmi20'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'bmi20grp'</span>,</span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'BMI at age 20 (group)'</span>,</span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">999</span>, <span class="dv">989</span>),</span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">50</span>), <span class="co"># Michael</span></span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">bands =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">10</span>, <span class="fu">seq</span>(<span class="fl">18.5</span>, <span class="dv">25</span>, <span class="fl">2.5</span>), <span class="dv">50</span>, <span class="sc">+</span><span class="cn">Inf</span>) <span class="co"># Michael</span></span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-122"><a href="#cb39-122" aria-hidden="true" tabindex="-1"></a>  <span class="st">'bodysizebmi20'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-123"><a href="#cb39-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'bodysizebmi20'</span>,</span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'BMI at age 20'</span>,</span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">999</span>, <span class="dv">989</span>),</span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">50</span>) <span class="co"># Michael</span></span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ACORN score</span></span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a>  <span class="st">'ses'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'ses'</span>,</span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'ACORN score'</span>,</span>
<span id="cb39-133"><a href="#cb39-133" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb39-134"><a href="#cb39-134" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'1'</span><span class="ot">=</span><span class="st">'Wealthy achievers'</span>, <span class="st">'2'</span><span class="ot">=</span><span class="st">'Urban prosperity'</span>, <span class="st">'3'</span><span class="ot">=</span><span class="st">'Comfortably off'</span>, <span class="st">'4'</span><span class="ot">=</span><span class="st">'Moderate means'</span>, <span class="st">'5'</span><span class="ot">=</span><span class="st">'Hard-pressed'</span>, <span class="st">'0'</span> <span class="ot">=</span> <span class="st">'Region not covered'</span>, <span class="st">'6'</span><span class="ot">=</span><span class="st">'Unclassified'</span>),</span>
<span id="cb39-135"><a href="#cb39-135" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb39-136"><a href="#cb39-136" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-137"><a href="#cb39-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-138"><a href="#cb39-138" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Family history of breast cancer</span></span>
<span id="cb39-139"><a href="#cb39-139" aria-hidden="true" tabindex="-1"></a>  <span class="st">'fambrca'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-140"><a href="#cb39-140" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'fambrca'</span>,</span>
<span id="cb39-141"><a href="#cb39-141" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Family history of breast cancer'</span>,</span>
<span id="cb39-142"><a href="#cb39-142" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'0'</span><span class="ot">=</span><span class="st">'Absent'</span>, <span class="st">'1'</span><span class="ot">=</span><span class="st">'Present'</span>)</span>
<span id="cb39-143"><a href="#cb39-143" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-144"><a href="#cb39-144" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-145"><a href="#cb39-145" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Benign breast disease</span></span>
<span id="cb39-146"><a href="#cb39-146" aria-hidden="true" tabindex="-1"></a>  <span class="st">'brbendis'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-147"><a href="#cb39-147" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'brbendis'</span>,</span>
<span id="cb39-148"><a href="#cb39-148" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Previous benign breast disease'</span>,</span>
<span id="cb39-149"><a href="#cb39-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'2'</span><span class="ot">=</span><span class="st">'No'</span>, <span class="st">'1'</span><span class="ot">=</span><span class="st">'Yes'</span>)</span>
<span id="cb39-150"><a href="#cb39-150" aria-hidden="true" tabindex="-1"></a>  ), </span>
<span id="cb39-151"><a href="#cb39-151" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-152"><a href="#cb39-152" aria-hidden="true" tabindex="-1"></a>  <span class="co"># HRT</span></span>
<span id="cb39-153"><a href="#cb39-153" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 'hrtprep' = list(</span></span>
<span id="cb39-154"><a href="#cb39-154" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   varname = 'hrtprep',</span></span>
<span id="cb39-155"><a href="#cb39-155" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   categories = c('1'='Estrogen', '2'='Estrogen and progesterone', '3'='Other', '9'='Not applicable')</span></span>
<span id="cb39-156"><a href="#cb39-156" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ),</span></span>
<span id="cb39-157"><a href="#cb39-157" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-158"><a href="#cb39-158" aria-hidden="true" tabindex="-1"></a>  <span class="st">'hrtstatus'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-159"><a href="#cb39-159" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'hrtstatus'</span>,</span>
<span id="cb39-160"><a href="#cb39-160" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'HRT status'</span>,</span>
<span id="cb39-161"><a href="#cb39-161" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">888</span>, <span class="dv">999</span>, <span class="dv">9999</span>), <span class="co"># Louise keeps 888/999/9999 intact (though only 999 actually appears in the data)</span></span>
<span id="cb39-162"><a href="#cb39-162" aria-hidden="true" tabindex="-1"></a>                                     <span class="co"># More specifically, per Michael, 999 means they are either Current/former, but we don't know which.</span></span>
<span id="cb39-163"><a href="#cb39-163" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'0'</span><span class="ot">=</span><span class="st">'Never'</span>, <span class="st">'1'</span><span class="ot">=</span><span class="st">'Former'</span>, <span class="st">'2'</span><span class="ot">=</span><span class="st">'Current'</span>)</span>
<span id="cb39-164"><a href="#cb39-164" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-165"><a href="#cb39-165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-166"><a href="#cb39-166" aria-hidden="true" tabindex="-1"></a>  <span class="st">'menarcheage'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-167"><a href="#cb39-167" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'menarchegrp'</span>,</span>
<span id="cb39-168"><a href="#cb39-168" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Age at menarche (group)'</span>,</span>
<span id="cb39-169"><a href="#cb39-169" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">777</span>, <span class="dv">888</span>, <span class="dv">999</span>), <span class="co"># Michael</span></span>
<span id="cb39-170"><a href="#cb39-170" aria-hidden="true" tabindex="-1"></a>                                    <span class="co"># Louise keeps 777/888/999 intact</span></span>
<span id="cb39-171"><a href="#cb39-171" aria-hidden="true" tabindex="-1"></a>    <span class="at">bands =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">15</span>, <span class="dv">19</span>) <span class="co"># Michael</span></span>
<span id="cb39-172"><a href="#cb39-172" aria-hidden="true" tabindex="-1"></a>    <span class="co">#bands = c(-Inf, 13, +Inf) # Louise</span></span>
<span id="cb39-173"><a href="#cb39-173" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-174"><a href="#cb39-174" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-175"><a href="#cb39-175" aria-hidden="true" tabindex="-1"></a>  <span class="st">'menarcheage'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-176"><a href="#cb39-176" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'menarcheage'</span>,</span>
<span id="cb39-177"><a href="#cb39-177" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Age at menarche (group)'</span>,</span>
<span id="cb39-178"><a href="#cb39-178" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">777</span>, <span class="dv">888</span>, <span class="dv">999</span>) </span>
<span id="cb39-179"><a href="#cb39-179" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-180"><a href="#cb39-180" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-181"><a href="#cb39-181" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Physical activity: </span></span>
<span id="cb39-182"><a href="#cb39-182" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Michael keeps PhysMetTotal continuous and does a log base 2 (i.e a doubling), centered at log2(median)</span></span>
<span id="cb39-183"><a href="#cb39-183" aria-hidden="true" tabindex="-1"></a>  <span class="st">'PhysMetTotal'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-184"><a href="#cb39-184" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'physmettotalgrp'</span>,</span>
<span id="cb39-185"><a href="#cb39-185" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Total physical activity (MET hours/week)'</span>,</span>
<span id="cb39-186"><a href="#cb39-186" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">8888</span>, <span class="dv">9999</span>), <span class="co"># Louise keeps these intact</span></span>
<span id="cb39-187"><a href="#cb39-187" aria-hidden="true" tabindex="-1"></a>    <span class="at">bands =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">2000</span>), <span class="co"># Louise</span></span>
<span id="cb39-188"><a href="#cb39-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'&lt; 25'</span>, <span class="st">'25-49'</span>, <span class="st">'50-74'</span>, <span class="st">'&gt; 75'</span>)</span>
<span id="cb39-189"><a href="#cb39-189" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-190"><a href="#cb39-190" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-191"><a href="#cb39-191" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Menopause (status): In Michael's code, seems to be deriving menopausal status based on age of menopause at ? end of follow-up</span></span>
<span id="cb39-192"><a href="#cb39-192" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-193"><a href="#cb39-193" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R1menopause'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-194"><a href="#cb39-194" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'R1menopause'</span>,</span>
<span id="cb39-195"><a href="#cb39-195" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Menopausal status at recruitment'</span>,</span>
<span id="cb39-196"><a href="#cb39-196" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>), <span class="co"># Louise keeps 8/9/10 intact </span></span>
<span id="cb39-197"><a href="#cb39-197" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'2'</span> <span class="ot">=</span> <span class="st">'Premenopausal'</span>, <span class="st">'4'</span> <span class="ot">=</span> <span class="st">'Premenopausal'</span>, <span class="st">'3'</span> <span class="ot">=</span> <span class="st">'Postmenopausal'</span>, <span class="st">'1'</span> <span class="ot">=</span> <span class="st">'Postmenopausal'</span>)</span>
<span id="cb39-198"><a href="#cb39-198" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-199"><a href="#cb39-199" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-200"><a href="#cb39-200" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R2menopause'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-201"><a href="#cb39-201" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'R2menopause'</span>,</span>
<span id="cb39-202"><a href="#cb39-202" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Menopausal status @ R2'</span>,</span>
<span id="cb39-203"><a href="#cb39-203" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>), </span>
<span id="cb39-204"><a href="#cb39-204" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'2'</span> <span class="ot">=</span> <span class="st">'Premenopausal'</span>, <span class="st">'4'</span> <span class="ot">=</span> <span class="st">'Premenopausal'</span>, <span class="st">'3'</span> <span class="ot">=</span> <span class="st">'Postmenopausal'</span>, <span class="st">'1'</span> <span class="ot">=</span> <span class="st">'Postmenopausal'</span>)</span>
<span id="cb39-205"><a href="#cb39-205" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-206"><a href="#cb39-206" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-207"><a href="#cb39-207" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R3menopause'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-208"><a href="#cb39-208" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'R3menopause'</span>,</span>
<span id="cb39-209"><a href="#cb39-209" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Menopausal status @ R3'</span>,</span>
<span id="cb39-210"><a href="#cb39-210" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>),  </span>
<span id="cb39-211"><a href="#cb39-211" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'2'</span> <span class="ot">=</span> <span class="st">'Premenopausal'</span>, <span class="st">'4'</span> <span class="ot">=</span> <span class="st">'Premenopausal'</span>, <span class="st">'3'</span> <span class="ot">=</span> <span class="st">'Postmenopausal'</span>, <span class="st">'1'</span> <span class="ot">=</span> <span class="st">'Postmenopausal'</span>)</span>
<span id="cb39-212"><a href="#cb39-212" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-213"><a href="#cb39-213" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-214"><a href="#cb39-214" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R4menopause'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-215"><a href="#cb39-215" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'R4menopause'</span>,</span>
<span id="cb39-216"><a href="#cb39-216" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Menopausal status @ R4'</span>,</span>
<span id="cb39-217"><a href="#cb39-217" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>),  </span>
<span id="cb39-218"><a href="#cb39-218" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'2'</span> <span class="ot">=</span> <span class="st">'Premenopausal'</span>, <span class="st">'4'</span> <span class="ot">=</span> <span class="st">'Premenopausal'</span>, <span class="st">'3'</span> <span class="ot">=</span> <span class="st">'Postmenopausal'</span>, <span class="st">'1'</span> <span class="ot">=</span> <span class="st">'Postmenopausal'</span>)</span>
<span id="cb39-219"><a href="#cb39-219" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-220"><a href="#cb39-220" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-221"><a href="#cb39-221" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTtype1_1'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-222"><a href="#cb39-222" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'HRTtype1_1'</span>,</span>
<span id="cb39-223"><a href="#cb39-223" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'HRT Type (1st)'</span></span>
<span id="cb39-224"><a href="#cb39-224" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-225"><a href="#cb39-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-226"><a href="#cb39-226" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTtype1_2'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-227"><a href="#cb39-227" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'HRTtype1_2'</span>,</span>
<span id="cb39-228"><a href="#cb39-228" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'HRT type (2nd)'</span></span>
<span id="cb39-229"><a href="#cb39-229" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-230"><a href="#cb39-230" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-231"><a href="#cb39-231" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTtype1_3'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-232"><a href="#cb39-232" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'HRTtype1_3'</span>,</span>
<span id="cb39-233"><a href="#cb39-233" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'HRT type (3rd)'</span></span>
<span id="cb39-234"><a href="#cb39-234" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-235"><a href="#cb39-235" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-236"><a href="#cb39-236" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTtype1_4'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-237"><a href="#cb39-237" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'HRTtype1_4'</span>,</span>
<span id="cb39-238"><a href="#cb39-238" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'HRT type (4th)'</span></span>
<span id="cb39-239"><a href="#cb39-239" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-240"><a href="#cb39-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-241"><a href="#cb39-241" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTstartage_1'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-242"><a href="#cb39-242" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'HRTstartage_1'</span>,</span>
<span id="cb39-243"><a href="#cb39-243" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'HRT start age (1st)'</span>,</span>
<span id="cb39-244"><a href="#cb39-244" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>) <span class="co"># Arbitrary</span></span>
<span id="cb39-245"><a href="#cb39-245" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-246"><a href="#cb39-246" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-247"><a href="#cb39-247" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTstartage_2'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-248"><a href="#cb39-248" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'HRTstartage_2'</span>,</span>
<span id="cb39-249"><a href="#cb39-249" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'HRT start age (2nd)'</span>,</span>
<span id="cb39-250"><a href="#cb39-250" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>) <span class="co"># Arbitrary</span></span>
<span id="cb39-251"><a href="#cb39-251" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-252"><a href="#cb39-252" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-253"><a href="#cb39-253" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTstartage_3'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-254"><a href="#cb39-254" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'HRTstartage_3'</span>,</span>
<span id="cb39-255"><a href="#cb39-255" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'HRT start age (3rd)'</span>,</span>
<span id="cb39-256"><a href="#cb39-256" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>) <span class="co"># Arbitrary</span></span>
<span id="cb39-257"><a href="#cb39-257" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-258"><a href="#cb39-258" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-259"><a href="#cb39-259" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTstartage_4'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-260"><a href="#cb39-260" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'HRTstartage_4'</span>,</span>
<span id="cb39-261"><a href="#cb39-261" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'HRT start age (4th)'</span>,</span>
<span id="cb39-262"><a href="#cb39-262" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>) <span class="co"># Arbitrary</span></span>
<span id="cb39-263"><a href="#cb39-263" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-264"><a href="#cb39-264" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-265"><a href="#cb39-265" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTendage_1'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-266"><a href="#cb39-266" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'HRTendage_1'</span>,</span>
<span id="cb39-267"><a href="#cb39-267" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'HRT end age (1st)'</span>,</span>
<span id="cb39-268"><a href="#cb39-268" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>) <span class="co"># Arbitrary</span></span>
<span id="cb39-269"><a href="#cb39-269" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-270"><a href="#cb39-270" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-271"><a href="#cb39-271" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTendage_2'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-272"><a href="#cb39-272" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'HRTendage_2'</span>,</span>
<span id="cb39-273"><a href="#cb39-273" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'HRT end age (2nd)'</span>,</span>
<span id="cb39-274"><a href="#cb39-274" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>) <span class="co"># Arbitrary</span></span>
<span id="cb39-275"><a href="#cb39-275" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-276"><a href="#cb39-276" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-277"><a href="#cb39-277" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTendage_3'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-278"><a href="#cb39-278" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'HRTendage_3'</span>,</span>
<span id="cb39-279"><a href="#cb39-279" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'HRT end age (3rd)'</span>,</span>
<span id="cb39-280"><a href="#cb39-280" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>) <span class="co"># Arbitrary</span></span>
<span id="cb39-281"><a href="#cb39-281" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-282"><a href="#cb39-282" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-283"><a href="#cb39-283" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTendage_4'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-284"><a href="#cb39-284" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'HRTendage_4'</span>,</span>
<span id="cb39-285"><a href="#cb39-285" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'HRT end age (4th)'</span>,</span>
<span id="cb39-286"><a href="#cb39-286" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>) <span class="co"># Arbitrary</span></span>
<span id="cb39-287"><a href="#cb39-287" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-288"><a href="#cb39-288" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-289"><a href="#cb39-289" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Oral contraceptive status</span></span>
<span id="cb39-290"><a href="#cb39-290" aria-hidden="true" tabindex="-1"></a>  <span class="st">'ocstatus'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-291"><a href="#cb39-291" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'ocstatus'</span>,</span>
<span id="cb39-292"><a href="#cb39-292" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Oral contraceptive status'</span>,</span>
<span id="cb39-293"><a href="#cb39-293" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">888</span>, <span class="dv">999</span>, <span class="dv">9999</span>), <span class="co"># Louise keeps 888/999/9999 intact</span></span>
<span id="cb39-294"><a href="#cb39-294" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'0'</span> <span class="ot">=</span> <span class="st">'Never'</span>, <span class="st">'1'</span> <span class="ot">=</span> <span class="st">'Former'</span>, <span class="st">'2'</span> <span class="ot">=</span> <span class="st">'Current'</span>)</span>
<span id="cb39-295"><a href="#cb39-295" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-296"><a href="#cb39-296" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-297"><a href="#cb39-297" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Parity </span></span>
<span id="cb39-298"><a href="#cb39-298" aria-hidden="true" tabindex="-1"></a>  <span class="st">'pregparitycnt'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-299"><a href="#cb39-299" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'pregparitycnt'</span>,</span>
<span id="cb39-300"><a href="#cb39-300" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Parity count'</span>,</span>
<span id="cb39-301"><a href="#cb39-301" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">99</span>)</span>
<span id="cb39-302"><a href="#cb39-302" aria-hidden="true" tabindex="-1"></a>    <span class="co"># exp_range = c(-Inf, 20),</span></span>
<span id="cb39-303"><a href="#cb39-303" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bands = c(0, 1, 2, 3, +Inf)</span></span>
<span id="cb39-304"><a href="#cb39-304" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-305"><a href="#cb39-305" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-306"><a href="#cb39-306" aria-hidden="true" tabindex="-1"></a>  <span class="st">'pregparitycnt'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-307"><a href="#cb39-307" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'pregparous'</span>,</span>
<span id="cb39-308"><a href="#cb39-308" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Parity status'</span>,</span>
<span id="cb39-309"><a href="#cb39-309" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">99</span>),</span>
<span id="cb39-310"><a href="#cb39-310" aria-hidden="true" tabindex="-1"></a>    <span class="at">bands =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="sc">+</span><span class="cn">Inf</span>),</span>
<span id="cb39-311"><a href="#cb39-311" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'Nulliparous'</span>, <span class="st">'Parous'</span>)</span>
<span id="cb39-312"><a href="#cb39-312" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split = list('Parous' =</span></span>
<span id="cb39-313"><a href="#cb39-313" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                on = 'Parous',</span></span>
<span id="cb39-314"><a href="#cb39-314" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                by = # Cannot complete as do not have breastfeeding information.</span></span>
<span id="cb39-315"><a href="#cb39-315" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                categories = c('Parous (not breastfed)', 'Parous (breastfed)'))</span></span>
<span id="cb39-316"><a href="#cb39-316" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-317"><a href="#cb39-317" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-318"><a href="#cb39-318" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Alcohol</span></span>
<span id="cb39-319"><a href="#cb39-319" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R1alcoholstatus'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-320"><a href="#cb39-320" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'R1alcoholstatus'</span>,</span>
<span id="cb39-321"><a href="#cb39-321" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Alcohol status at recruitment'</span>,</span>
<span id="cb39-322"><a href="#cb39-322" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">9</span>),</span>
<span id="cb39-323"><a href="#cb39-323" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'0'</span> <span class="ot">=</span> <span class="st">'Never'</span>, <span class="st">'1'</span> <span class="ot">=</span> <span class="st">'Current'</span>, <span class="st">'2'</span> <span class="ot">=</span> <span class="st">'Past'</span>)</span>
<span id="cb39-324"><a href="#cb39-324" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-325"><a href="#cb39-325" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-326"><a href="#cb39-326" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R1alcoholunits'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-327"><a href="#cb39-327" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'R1alcoholunits'</span>,</span>
<span id="cb39-328"><a href="#cb39-328" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Alcohol units (per week) at recruitment'</span>,</span>
<span id="cb39-329"><a href="#cb39-329" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>)</span>
<span id="cb39-330"><a href="#cb39-330" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-331"><a href="#cb39-331" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-332"><a href="#cb39-332" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R2alcoholstatus'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-333"><a href="#cb39-333" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'R2alcoholstatus'</span>,</span>
<span id="cb39-334"><a href="#cb39-334" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Alcohol status @ R2'</span>,</span>
<span id="cb39-335"><a href="#cb39-335" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">9</span>),</span>
<span id="cb39-336"><a href="#cb39-336" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'0'</span> <span class="ot">=</span> <span class="st">'Never'</span>, <span class="st">'1'</span> <span class="ot">=</span> <span class="st">'Current'</span>, <span class="st">'2'</span> <span class="ot">=</span> <span class="st">'Past'</span>)</span>
<span id="cb39-337"><a href="#cb39-337" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-338"><a href="#cb39-338" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-339"><a href="#cb39-339" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R2alcoholunits'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-340"><a href="#cb39-340" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'R2alcoholunits'</span>,</span>
<span id="cb39-341"><a href="#cb39-341" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Alcohol units (per week) @ R2'</span>,</span>
<span id="cb39-342"><a href="#cb39-342" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>)</span>
<span id="cb39-343"><a href="#cb39-343" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-344"><a href="#cb39-344" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-345"><a href="#cb39-345" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R4alcoholstatus'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-346"><a href="#cb39-346" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'R4alcoholstatus'</span>,</span>
<span id="cb39-347"><a href="#cb39-347" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Alcohol status @ R4'</span>,</span>
<span id="cb39-348"><a href="#cb39-348" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">9</span>),</span>
<span id="cb39-349"><a href="#cb39-349" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'0'</span> <span class="ot">=</span> <span class="st">'Never'</span>, <span class="st">'1'</span> <span class="ot">=</span> <span class="st">'Current'</span>, <span class="st">'2'</span> <span class="ot">=</span> <span class="st">'Past'</span>)</span>
<span id="cb39-350"><a href="#cb39-350" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-351"><a href="#cb39-351" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-352"><a href="#cb39-352" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R4alcoholunits'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-353"><a href="#cb39-353" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'R4alcoholunits'</span>,</span>
<span id="cb39-354"><a href="#cb39-354" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Alcohol units (per week) @ R4'</span>,</span>
<span id="cb39-355"><a href="#cb39-355" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>)</span>
<span id="cb39-356"><a href="#cb39-356" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-357"><a href="#cb39-357" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-358"><a href="#cb39-358" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Smoking</span></span>
<span id="cb39-359"><a href="#cb39-359" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R1smokingstatus'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-360"><a href="#cb39-360" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'R1smokingstatus'</span>,</span>
<span id="cb39-361"><a href="#cb39-361" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Smoking status at recruitment'</span>,</span>
<span id="cb39-362"><a href="#cb39-362" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">6</span>, <span class="dv">9</span>),</span>
<span id="cb39-363"><a href="#cb39-363" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'0'</span> <span class="ot">=</span> <span class="st">'Never'</span>, <span class="st">'1'</span> <span class="ot">=</span> <span class="st">'Former'</span>, <span class="st">'2'</span> <span class="ot">=</span> <span class="st">'Current'</span>)</span>
<span id="cb39-364"><a href="#cb39-364" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-365"><a href="#cb39-365" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-366"><a href="#cb39-366" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R2smokingstatus'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-367"><a href="#cb39-367" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'R2smokingstatus'</span>,</span>
<span id="cb39-368"><a href="#cb39-368" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Smoking status @ R2'</span>,</span>
<span id="cb39-369"><a href="#cb39-369" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">6</span>, <span class="dv">9</span>),</span>
<span id="cb39-370"><a href="#cb39-370" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'0'</span> <span class="ot">=</span> <span class="st">'Never'</span>, <span class="st">'1'</span> <span class="ot">=</span> <span class="st">'Former'</span>, <span class="st">'2'</span> <span class="ot">=</span> <span class="st">'Current'</span>)</span>
<span id="cb39-371"><a href="#cb39-371" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-372"><a href="#cb39-372" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-373"><a href="#cb39-373" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R4smokingstatus'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-374"><a href="#cb39-374" aria-hidden="true" tabindex="-1"></a>    <span class="at">varname =</span> <span class="st">'R4smokingstatus'</span>,</span>
<span id="cb39-375"><a href="#cb39-375" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Smoking status @ R4'</span>,</span>
<span id="cb39-376"><a href="#cb39-376" aria-hidden="true" tabindex="-1"></a>    <span class="at">unknown =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">6</span>, <span class="dv">9</span>),</span>
<span id="cb39-377"><a href="#cb39-377" aria-hidden="true" tabindex="-1"></a>    <span class="at">categories =</span> <span class="fu">c</span>(<span class="st">'0'</span> <span class="ot">=</span> <span class="st">'Never'</span>, <span class="st">'1'</span> <span class="ot">=</span> <span class="st">'Former'</span>, <span class="st">'2'</span> <span class="ot">=</span> <span class="st">'Current'</span>)</span>
<span id="cb39-378"><a href="#cb39-378" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-379"><a href="#cb39-379" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-380"><a href="#cb39-380" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Age at thelarche (Michael's code)</span></span>
<span id="cb39-381"><a href="#cb39-381" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-382"><a href="#cb39-382" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Birthweight (Michael's code)</span></span>
<span id="cb39-383"><a href="#cb39-383" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-384"><a href="#cb39-384" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-385"><a href="#cb39-385" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="recording-deriving-variables-grouping" class="level4">
<h4 class="anchored" data-anchor-id="recording-deriving-variables-grouping">Recording, deriving variables, grouping</h4>
</section>
<section id="recoding" class="level4">
<h4 class="anchored" data-anchor-id="recoding">Recoding</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parity variable</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Recoding -1 (never pregnant) to 0 (nulliparous)</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>dataset_rf<span class="sc">$</span>pregparitycnt[<span class="sc">!</span><span class="fu">is.na</span>(dataset_rf<span class="sc">$</span>pregparitycnt) <span class="sc">&amp;</span> dataset_rf<span class="sc">$</span>pregparitycnt <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Height at 20</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting those with a defined height at 20 despite being less than 20 years old to NA</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>under_20_mask <span class="ot">&lt;-</span> <span class="fu">year_diff</span>(dataset_rf<span class="sc">$</span>DOB, dataset_rf<span class="sc">$</span>fupca_start) <span class="sc">&lt;</span> <span class="dv">20</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>under_20_mask[<span class="fu">is.na</span>(under_20_mask)] <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>dataset_rf[under_20_mask,<span class="st">'bodysizeht20'</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span> </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co"># In Michael's code, a missing height at 20 is updated to equal adult height.</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Weight at 20</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting those with a defined weight at 20 despite being less than 20 years old to NA.</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>dataset_rf[under_20_mask,<span class="st">'bodysizewt20'</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span> </span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co"># BMI at 20</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting those with a defined BMI at 20 despite being less than 20 years old to NA.</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>dataset_rf[under_20_mask,<span class="st">'bodysizebmi20'</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span> </span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="co"># In Michael's code, an additional 'bmi20_updated' variable is made using adult height, if height at 20 is missing.</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Age at each delivery</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Derived from pregdate_[0:9]</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>dataset_rf <span class="ot">&lt;-</span> dataset_rf <span class="sc">%&gt;%</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">'pregdate_'</span>), </span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>                \(x) <span class="fu">year_diff</span>(ADOB_F, x),</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">'age_at_{.col}'</span>))</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Age at dates of questionnaire returns</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Derived from QR2_date [0:9]</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>dataset_rf <span class="ot">&lt;-</span> dataset_rf <span class="sc">%&gt;%</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">matches</span>(<span class="st">'^QR</span><span class="sc">\\</span><span class="st">d+_date_'</span>), </span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>                \(x) <span class="fu">year_diff</span>(ADOB_F, x),</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">'age_at_{.col}'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Code for applying the custom configuration file</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(idx <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">length</span>(rf_config))) {</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">names</span>(rf_config)[[idx]]</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  config <span class="ot">=</span> rf_config[[idx]]</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  varname <span class="ot">=</span> config<span class="sc">$</span>varname</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  dataset_rf[[varname]] <span class="ot">&lt;-</span> dataset_rf[[var]]</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'Pre-processing </span><span class="sc">\'</span><span class="st">'</span>, var, <span class="st">'</span><span class="sc">\'</span><span class="st"> =&gt; </span><span class="sc">\'</span><span class="st">'</span>, varname, <span class="st">'</span><span class="sc">\'</span><span class="st">:'</span>))</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(config<span class="sc">$</span>unknown)) {</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    unk_vals <span class="ot">&lt;-</span> config<span class="sc">$</span>unknown</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    unk_mask <span class="ot">&lt;-</span> (dataset_rf[[varname]] <span class="sc">%in%</span> unk_vals)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'  '</span>, <span class="fu">sum</span>(unk_mask, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="st">' ('</span>, <span class="fu">round</span>(<span class="fu">sum</span>(unk_mask, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">nrow</span>(dataset_rf), <span class="dv">4</span>)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'%) have a missing code.'</span>))</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    dataset_rf[unk_mask,varname] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(config<span class="sc">$</span>exp_range)) {</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    accepted_range <span class="ot">&lt;-</span> config<span class="sc">$</span>exp_range</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    outrange_mask <span class="ot">&lt;-</span> <span class="sc">!</span>((dataset_rf[[varname]] <span class="sc">&gt;=</span> accepted_range[<span class="dv">1</span>]) <span class="sc">&amp;</span> (dataset_rf[[varname]] <span class="sc">&lt;=</span> accepted_range[<span class="dv">2</span>]))</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'  '</span>, <span class="fu">sum</span>(outrange_mask, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="st">' of the </span><span class="sc">\'</span><span class="st">'</span>, var, <span class="st">'</span><span class="sc">\'</span><span class="st"> variable are deemed outliers.'</span>))</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>    dataset_rf[<span class="sc">!</span><span class="fu">is.na</span>(outrange_mask) <span class="sc">&amp;</span> outrange_mask, varname] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(config<span class="sc">$</span>bands)) {</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>    bands <span class="ot">&lt;-</span> config<span class="sc">$</span>bands</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    labels <span class="ot">&lt;-</span> config<span class="sc">$</span>categories</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'  '</span>, <span class="st">"Grouping into: "</span>, <span class="fu">paste</span>(bands, <span class="at">collapse =</span> <span class="st">", "</span>)))</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(labels))) {</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>      dataset_rf[[varname]] <span class="ot">&lt;-</span> <span class="fu">cut</span>(dataset_rf[[varname]], bands, <span class="at">labels =</span> labels, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>      dataset_rf[[varname]] <span class="ot">&lt;-</span> <span class="fu">cut</span>(dataset_rf[[varname]], bands, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(config<span class="sc">$</span>categories)) {</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>    labels <span class="ot">&lt;-</span> config<span class="sc">$</span>categories</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'  '</span>, <span class="st">"Refactoring into: "</span>, <span class="fu">paste</span>(labels, <span class="at">collapse =</span> <span class="st">", "</span>)))</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(labels))) {</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>      dataset_rf[[varname]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset_rf[[varname]], <span class="at">levels =</span> <span class="fu">names</span>(labels), <span class="at">labels =</span> labels, <span class="at">ordered =</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(config<span class="sc">$</span>ordered), <span class="cn">FALSE</span>, config<span class="sc">$</span>ordered))</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>      dataset_rf[[varname]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset_rf[[varname]], <span class="at">labels =</span> labels, <span class="at">ordered =</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(config<span class="sc">$</span>ordered), <span class="cn">FALSE</span>, config<span class="sc">$</span>ordered))</span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Pre-processing 'AgeatEntry' =&gt; 'ageentrygrp':"
[1] "  Grouping into: 16, 35, 45, 55, 65, 75, 102"
[1] "Pre-processing 'bodysizeht' =&gt; 'bodysizeht':"
[1] "  403 (0.38%) have a missing code."
[1] "  57 of the 'bodysizeht' variable are deemed outliers."
[1] "Pre-processing 'bodysizeht' =&gt; 'heightgrp':"
[1] "  460 (0.44%) have a missing code."
[1] "  Grouping into: 140, 160, 165, 170, 175, 220"
[1] "Pre-processing 'bodysizeht20' =&gt; 'bodysizeht20':"
[1] "  17962 (17.16%) have a missing code."
[1] "  49 of the 'bodysizeht20' variable are deemed outliers."
[1] "Pre-processing 'bodysizeht20' =&gt; 'height20grp':"
[1] "  18011 (17.2%) have a missing code."
[1] "  Grouping into: 140, 160, 165, 170, 175, 220"
[1] "Pre-processing 'bodysizewt20' =&gt; 'bodysizewt20':"
[1] "  4342 (4.15%) have a missing code."
[1] "  189 of the 'bodysizewt20' variable are deemed outliers."
[1] "Pre-processing 'bodysizewt20' =&gt; 'weight20grp':"
[1] "  4531 (4.33%) have a missing code."
[1] "  Grouping into: 40, 50, 55, 60, 70, 200"
[1] "Pre-processing 'bodysizebminow' =&gt; 'bminowgrp':"
[1] "  3038 (2.9%) have a missing code."
[1] "  87 of the 'bodysizebminow' variable are deemed outliers."
[1] "  Grouping into: 1, 20, 25, 100"
[1] "  Refactoring into: &lt; 20, 20-24, &gt;=25"
[1] "Pre-processing 'bodysizebminow' =&gt; 'bodysizebminow':"
[1] "  3038 (2.9%) have a missing code."
[1] "  87 of the 'bodysizebminow' variable are deemed outliers."
[1] "Pre-processing 'R2bodysizebmi' =&gt; 'R2bodysizebmi':"
[1] "  10761 (10.28%) have a missing code."
[1] "  96 of the 'R2bodysizebmi' variable are deemed outliers."
[1] "Pre-processing 'R4bodysizebmi' =&gt; 'R2bodysizebmi':"
[1] "  32388 (30.94%) have a missing code."
[1] "  194 of the 'R4bodysizebmi' variable are deemed outliers."
[1] "Pre-processing 'bodysizebmi20' =&gt; 'bmi20grp':"
[1] "  20044 (19.15%) have a missing code."
[1] "  10 of the 'bodysizebmi20' variable are deemed outliers."
[1] "  Grouping into: -Inf, 10, 18.5, 21, 23.5, 50, Inf"
[1] "Pre-processing 'bodysizebmi20' =&gt; 'bodysizebmi20':"
[1] "  20044 (19.15%) have a missing code."
[1] "  10 of the 'bodysizebmi20' variable are deemed outliers."
[1] "Pre-processing 'ses' =&gt; 'ses':"
[1] "  1249 (1.19%) have a missing code."
[1] "  Refactoring into: Wealthy achievers, Urban prosperity, Comfortably off, Moderate means, Hard-pressed, Region not covered, Unclassified"
[1] "Pre-processing 'fambrca' =&gt; 'fambrca':"
[1] "  Refactoring into: Absent, Present"
[1] "Pre-processing 'brbendis' =&gt; 'brbendis':"
[1] "  Refactoring into: No, Yes"
[1] "Pre-processing 'hrtstatus' =&gt; 'hrtstatus':"
[1] "  464 (0.44%) have a missing code."
[1] "  Refactoring into: Never, Former, Current"
[1] "Pre-processing 'menarcheage' =&gt; 'menarchegrp':"
[1] "  10781 (10.3%) have a missing code."
[1] "  Grouping into: 8, 11, 13, 15, 19"
[1] "Pre-processing 'menarcheage' =&gt; 'menarcheage':"
[1] "  10781 (10.3%) have a missing code."
[1] "Pre-processing 'PhysMetTotal' =&gt; 'physmettotalgrp':"
[1] "  901 (0.86%) have a missing code."
[1] "  Grouping into: 0, 25, 50, 75, 2000"
[1] "  Refactoring into: &lt; 25, 25-49, 50-74, &gt; 75"
[1] "Pre-processing 'R1menopause' =&gt; 'R1menopause':"
[1] "  23 (0.02%) have a missing code."
[1] "  Refactoring into: Premenopausal, Premenopausal, Postmenopausal, Postmenopausal"
[1] "Pre-processing 'R2menopause' =&gt; 'R2menopause':"
[1] "  3725 (3.56%) have a missing code."
[1] "  Refactoring into: Premenopausal, Premenopausal, Postmenopausal, Postmenopausal"
[1] "Pre-processing 'R3menopause' =&gt; 'R3menopause':"
[1] "  5406 (5.16%) have a missing code."
[1] "  Refactoring into: Premenopausal, Premenopausal, Postmenopausal, Postmenopausal"
[1] "Pre-processing 'R4menopause' =&gt; 'R4menopause':"
[1] "  29278 (27.97%) have a missing code."
[1] "  Refactoring into: Premenopausal, Premenopausal, Postmenopausal, Postmenopausal"
[1] "Pre-processing 'HRTtype1_1' =&gt; 'HRTtype1_1':"
[1] "Pre-processing 'HRTtype1_2' =&gt; 'HRTtype1_2':"
[1] "Pre-processing 'HRTtype1_3' =&gt; 'HRTtype1_3':"
[1] "Pre-processing 'HRTtype1_4' =&gt; 'HRTtype1_4':"
[1] "Pre-processing 'HRTstartage_1' =&gt; 'HRTstartage_1':"
[1] "  0 of the 'HRTstartage_1' variable are deemed outliers."
[1] "Pre-processing 'HRTstartage_2' =&gt; 'HRTstartage_2':"
[1] "  1 of the 'HRTstartage_2' variable are deemed outliers."
[1] "Pre-processing 'HRTstartage_3' =&gt; 'HRTstartage_3':"
[1] "  0 of the 'HRTstartage_3' variable are deemed outliers."
[1] "Pre-processing 'HRTstartage_4' =&gt; 'HRTstartage_4':"
[1] "  0 of the 'HRTstartage_4' variable are deemed outliers."
[1] "Pre-processing 'HRTendage_1' =&gt; 'HRTendage_1':"
[1] "  2 of the 'HRTendage_1' variable are deemed outliers."
[1] "Pre-processing 'HRTendage_2' =&gt; 'HRTendage_2':"
[1] "  0 of the 'HRTendage_2' variable are deemed outliers."
[1] "Pre-processing 'HRTendage_3' =&gt; 'HRTendage_3':"
[1] "  0 of the 'HRTendage_3' variable are deemed outliers."
[1] "Pre-processing 'HRTendage_4' =&gt; 'HRTendage_4':"
[1] "  0 of the 'HRTendage_4' variable are deemed outliers."
[1] "Pre-processing 'ocstatus' =&gt; 'ocstatus':"
[1] "  91 (0.09%) have a missing code."
[1] "  Refactoring into: Never, Former, Current"
[1] "Pre-processing 'pregparitycnt' =&gt; 'pregparitycnt':"
[1] "  158 (0.15%) have a missing code."
[1] "Pre-processing 'pregparitycnt' =&gt; 'pregparous':"
[1] "  158 (0.15%) have a missing code."
[1] "  Grouping into: 0, 1, Inf"
[1] "  Refactoring into: Nulliparous, Parous"
[1] "Pre-processing 'R1alcoholstatus' =&gt; 'R1alcoholstatus':"
[1] "  0 (0%) have a missing code."
[1] "  Refactoring into: Never, Current, Past"
[1] "Pre-processing 'R1alcoholunits' =&gt; 'R1alcoholunits':"
[1] "  1244 (1.19%) have a missing code."
[1] "Pre-processing 'R2alcoholstatus' =&gt; 'R2alcoholstatus':"
[1] "  0 (0%) have a missing code."
[1] "  Refactoring into: Never, Current, Past"
[1] "Pre-processing 'R2alcoholunits' =&gt; 'R2alcoholunits':"
[1] "  29530 (28.21%) have a missing code."
[1] "Pre-processing 'R4alcoholstatus' =&gt; 'R4alcoholstatus':"
[1] "  0 (0%) have a missing code."
[1] "  Refactoring into: Never, Current, Past"
[1] "Pre-processing 'R4alcoholunits' =&gt; 'R4alcoholunits':"
[1] "  47445 (45.32%) have a missing code."
[1] "Pre-processing 'R1smokingstatus' =&gt; 'R1smokingstatus':"
[1] "  118 (0.11%) have a missing code."
[1] "  Refactoring into: Never, Former, Current"
[1] "Pre-processing 'R2smokingstatus' =&gt; 'R2smokingstatus':"
[1] "  3804 (3.63%) have a missing code."
[1] "  Refactoring into: Never, Former, Current"
[1] "Pre-processing 'R4smokingstatus' =&gt; 'R4smokingstatus':"
[1] "  30480 (29.11%) have a missing code."
[1] "  Refactoring into: Never, Former, Current"</code></pre>
</div>
</div>
</section>
<section id="creating-merged-dataset-risk-factors-survival-data" class="level4">
<h4 class="anchored" data-anchor-id="creating-merged-dataset-risk-factors-survival-data">Creating merged dataset (risk factors + survival data)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Only selecting risk factor variables needed for analysis (not necessary, but just for reducing clutter later on)</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>dataset_rf_subset <span class="ot">&lt;-</span> dataset_rf[, <span class="fu">c</span>(<span class="st">'TCode'</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R1alcoholstatus'</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R1alcoholunits'</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R2alcoholstatus'</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R2alcoholunits'</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R4alcoholstatus'</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R4alcoholunits'</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R1smokingstatus'</span>,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R2smokingstatus'</span>,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R4smokingstatus'</span>,</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">'brbendis'</span>,</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">'bminowgrp'</span>,</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">'bodysizebminow'</span>,</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">'bodysizebmi20'</span>,</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">'fambrca'</span>,</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">'hrtstatus'</span>,</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTtype1_1'</span>,</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTtype1_2'</span>,</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTtype1_3'</span>,</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTtype1_4'</span>,</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTstartage_1'</span>,</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTstartage_2'</span>,</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTstartage_3'</span>,</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTstartage_4'</span>,</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTendage_1'</span>,</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTendage_2'</span>,</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTendage_3'</span>,</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">'HRTendage_4'</span>,</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">'menarchegrp'</span>,</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">'menarcheage'</span>,</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">'ocstatus'</span>,</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">'physmettotalgrp'</span>,</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R1smokingstatus'</span>,</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">'pregparous'</span>,</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">'pregparitycnt'</span>,</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">'age_at_pregdate_1_f'</span>,</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R1menopause'</span>,</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">'ses'</span>,</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">'age_at_QR2_date_f'</span>,</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">'age_at_QR4_date_f'</span>,</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R2bodysizebmi'</span>,</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R4bodysizebmi'</span></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Merging this to survival data</span></span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>dataset_surv_rf <span class="ot">&lt;-</span> survival_data[,<span class="fu">c</span>(<span class="st">'TCode'</span>, <span class="st">'event'</span>, <span class="st">'fupca_start_age'</span>, <span class="st">'c_age'</span>)] <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(dataset_rf_subset, <span class="at">by =</span> <span class="st">'TCode'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Missingness handling (current handling: complete case analysis)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fraction missing per column</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">colSums</span>(<span class="fu">is.na</span>(dataset_surv_rf))<span class="sc">/</span><span class="fu">nrow</span>(dataset_surv_rf),<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              TCode               event     fupca_start_age               c_age 
             0.0000              0.0000              0.0000              0.0000 
    R1alcoholstatus      R1alcoholunits     R2alcoholstatus      R2alcoholunits 
             0.0000              0.0119              0.0354              0.2821 
    R4alcoholstatus      R4alcoholunits     R1smokingstatus     R2smokingstatus 
             0.2795              0.4532              0.0011              0.0363 
    R4smokingstatus            brbendis           bminowgrp      bodysizebminow 
             0.2911              0.0000              0.0298              0.0298 
      bodysizebmi20             fambrca           hrtstatus          HRTtype1_1 
             0.1915              0.0000              0.0044              0.6751 
         HRTtype1_2          HRTtype1_3          HRTtype1_4       HRTstartage_1 
             0.9678              0.9972              0.9998              0.6860 
      HRTstartage_2       HRTstartage_3       HRTstartage_4         HRTendage_1 
             0.9678              0.9972              0.9998              0.6784 
        HRTendage_2         HRTendage_3         HRTendage_4         menarchegrp 
             0.9680              0.9972              0.9998              0.1033 
        menarcheage            ocstatus     physmettotalgrp   R1smokingstatus.1 
             0.1030              0.0009              0.0086              0.0011 
         pregparous       pregparitycnt age_at_pregdate_1_f         R1menopause 
             0.0015              0.0015              0.1780              0.0002 
                ses   age_at_QR2_date_f   age_at_QR4_date_f       R2bodysizebmi 
             0.0119              0.0354              0.2788              0.3112 
      R4bodysizebmi 
             0.0015 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Complete case analysis</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cplt_case_mask &lt;- complete.cases(dataset_surv_rf)</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print(paste0((round(sum(!cplt_case_mask)/nrow(dataset_surv_rf), 4))*100, '% of the individuals have at least 1 missing value, and they have all been removed.'))</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># dataset_surv_rf &lt;- dataset_surv_rf[complete.cases(dataset_surv_rf),]</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the single person with a censored date == follow-up start date:</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>dataset_surv_rf <span class="ot">&lt;-</span> dataset_surv_rf[dataset_surv_rf<span class="sc">$</span>fupca_start_age<span class="sc">!=</span>dataset_surv_rf<span class="sc">$</span>c_age,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis">Analysis</h2>
<section id="visualisation" class="level4">
<h4 class="anchored" data-anchor-id="visualisation">Visualisation</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Family history</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit2</span>(<span class="fu">Surv</span>(fupca_start_age, c_age, event) <span class="sc">~</span> fambrca, <span class="at">data =</span> dataset_surv_rf) <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsurvfit</span>(<span class="at">type =</span> <span class="st">"risk"</span>) <span class="sc">+</span> <span class="fu">add_risktable</span>() <span class="sc">+</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cumulative incidence"</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">add_confidence_interval</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Family history of breast cancer"</span>) <span class="sc">+</span> </span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'royalblue'</span>, <span class="st">'tomato'</span>)) <span class="sc">+</span> </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'royalblue'</span>, <span class="st">'tomato'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Benign breast disease</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit2</span>(<span class="fu">Surv</span>(fupca_start_age, c_age, event) <span class="sc">~</span> brbendis, <span class="at">data =</span> dataset_surv_rf) <span class="sc">%&gt;%</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsurvfit</span>(<span class="at">type =</span> <span class="st">"risk"</span>) <span class="sc">+</span> <span class="fu">add_risktable</span>() <span class="sc">+</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cumulative incidence"</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">add_confidence_interval</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Benign breast disease"</span>) <span class="sc">+</span> </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'royalblue'</span>, <span class="st">'tomato'</span>)) <span class="sc">+</span> </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'royalblue'</span>, <span class="st">'tomato'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ACORN score</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit2</span>(<span class="fu">Surv</span>(fupca_start_age, c_age, event) <span class="sc">~</span> ses, <span class="at">data =</span> dataset_surv_rf) <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsurvfit</span>(<span class="at">type =</span> <span class="st">"risk"</span>) <span class="sc">+</span> <span class="fu">add_risktable</span>() <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cumulative incidence"</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">add_confidence_interval</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"ACORN score"</span>) <span class="co">#+ </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-17-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_color_manual(values = c('tomato', 'royalblue')) + </span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_fill_manual(values = c('tomato', 'royalblue'))</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># BMI</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit2</span>(<span class="fu">Surv</span>(fupca_start_age, c_age, event) <span class="sc">~</span> bminowgrp, <span class="at">data =</span> dataset_surv_rf) <span class="sc">%&gt;%</span> </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsurvfit</span>(<span class="at">type =</span> <span class="st">"risk"</span>) <span class="sc">+</span> <span class="fu">add_risktable</span>() <span class="sc">+</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cumulative incidence"</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">add_confidence_interval</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Body mass index"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-17-4.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parity</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit2</span>(<span class="fu">Surv</span>(fupca_start_age, c_age, event) <span class="sc">~</span> pregparous, <span class="at">data =</span> dataset_surv_rf) <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsurvfit</span>(<span class="at">type =</span> <span class="st">"risk"</span>) <span class="sc">+</span> <span class="fu">add_risktable</span>() <span class="sc">+</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cumulative incidence"</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">add_confidence_interval</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Parity"</span>) <span class="sc">+</span> </span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'tomato'</span>, <span class="st">'royalblue'</span>)) <span class="sc">+</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'tomato'</span>, <span class="st">'royalblue'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-17-5.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Physical activity</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit2</span>(<span class="fu">Surv</span>(fupca_start_age, c_age, event) <span class="sc">~</span> physmettotalgrp, <span class="at">data =</span> dataset_surv_rf) <span class="sc">%&gt;%</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsurvfit</span>(<span class="at">type =</span> <span class="st">"risk"</span>) <span class="sc">+</span> <span class="fu">add_risktable</span>() <span class="sc">+</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cumulative incidence"</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">add_confidence_interval</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Physical activity (METs)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-17-6.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alcohol status</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit2</span>(<span class="fu">Surv</span>(fupca_start_age, c_age, event) <span class="sc">~</span> R1alcoholstatus, <span class="at">data =</span> dataset_surv_rf) <span class="sc">%&gt;%</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsurvfit</span>(<span class="at">type =</span> <span class="st">"risk"</span>) <span class="sc">+</span> <span class="fu">add_risktable</span>() <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cumulative incidence"</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">add_confidence_interval</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Alcohol status"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-17-7.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Smoking status</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit2</span>(<span class="fu">Surv</span>(fupca_start_age, c_age, event) <span class="sc">~</span> R1smokingstatus, <span class="at">data =</span> dataset_surv_rf) <span class="sc">%&gt;%</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsurvfit</span>(<span class="at">type =</span> <span class="st">"risk"</span>) <span class="sc">+</span> <span class="fu">add_risktable</span>() <span class="sc">+</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cumulative incidence"</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">add_confidence_interval</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Smoking status"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="generations_files/figure-html/unnamed-chunk-17-8.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="analysis-1" class="level4">
<h4 class="anchored" data-anchor-id="analysis-1">Analysis</h4>
<p>Configuration</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuration for setting up the analysis</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the element: Variable to analyse ("base variable")</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 'realname': Real-world identifier for variable</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 'missing_group': Values to place into missing category</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 'trends': Continuous/ordinal variables to model an interaction with</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># # 'on': The interacting variable</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # 'per': Scaling of the interacting variable (e.g., per 10 units of alcohol)</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # 'reference_level': Where to set the 'intercept'</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # 'by_missing_group': Values of the interacting variable to consider missing</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: I need to change this code so that 'trends' allows interactions with not only continuous/ordinal, but also unordered categorical variables - the plan is to change the wording of 'trends' to 'interactions', and allow two types (either continuous/ordinal and unordered categorical). This will be necessary to fully replicate Michael's results re: HRT (as the categorical HRT use is only considered in menopausal women (ie., an interaction with an indicator variable))</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: Allow for multivariable analysis (ie., controlling for all other variables)</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>analysis_config <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Family history</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">'fambrca'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Family history of breast cancer'</span>,</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">missing_group =</span> <span class="fu">c</span>(<span class="cn">NA</span>)</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Benign breast disease</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">'brbendis'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'History of benign breast disease'</span>,</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">missing_group =</span> <span class="fu">c</span>(<span class="cn">NA</span>)</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bodysizebmi20</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">'bodysizebmi20'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'BMI at age 20'</span>,</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">trends =</span> </span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="st">'Trend by unit BMI increase'</span> <span class="ot">=</span> </span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>             <span class="fu">list</span>(</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>               <span class="at">on =</span> <span class="st">'bodysizebmi20'</span>,</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>               <span class="at">per =</span> <span class="dv">1</span>,</span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">reference_level =</span> <span class="fl">22.5</span>,</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>               <span class="at">by_missing_group =</span> <span class="fu">c</span>(<span class="cn">NA</span>)</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># BMI</span></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">'bodysizebminow'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'BMI'</span>,</span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">trends =</span> </span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="st">'Trend by unit BMI increase'</span> <span class="ot">=</span> </span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a>             <span class="fu">list</span>(</span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>               <span class="at">on =</span> <span class="st">'bodysizebminow'</span>,</span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a>               <span class="at">per =</span> <span class="dv">1</span>,</span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>               <span class="at">reference_level =</span> <span class="fl">22.5</span>,</span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a>               <span class="at">by_missing_group =</span> <span class="fu">c</span>(<span class="cn">NA</span>)</span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Age at menarche</span></span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a>  <span class="st">'menarcheage'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Age at menarche'</span>,</span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">trends =</span> </span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="st">'Trend by age (per year)'</span> <span class="ot">=</span></span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a>             <span class="fu">list</span>(</span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a>               <span class="at">on =</span> <span class="st">'menarcheage'</span>,</span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a>               <span class="at">per =</span> <span class="dv">1</span>,</span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a>               <span class="at">reference_level =</span> <span class="dv">13</span>,</span>
<span id="cb55-65"><a href="#cb55-65" aria-hidden="true" tabindex="-1"></a>               <span class="at">by_missing_group =</span> <span class="fu">c</span>(<span class="cn">NA</span>)</span>
<span id="cb55-66"><a href="#cb55-66" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb55-67"><a href="#cb55-67" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb55-68"><a href="#cb55-68" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb55-69"><a href="#cb55-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-70"><a href="#cb55-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Alcohol</span></span>
<span id="cb55-71"><a href="#cb55-71" aria-hidden="true" tabindex="-1"></a>  <span class="st">'R1alcoholstatus'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb55-72"><a href="#cb55-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Alcohol'</span>,</span>
<span id="cb55-73"><a href="#cb55-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">missing_group =</span> <span class="fu">c</span>(<span class="cn">NA</span>),</span>
<span id="cb55-74"><a href="#cb55-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">trends =</span></span>
<span id="cb55-75"><a href="#cb55-75" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="st">'Alcohol consumption (per 10 units)'</span> <span class="ot">=</span></span>
<span id="cb55-76"><a href="#cb55-76" aria-hidden="true" tabindex="-1"></a>             <span class="fu">list</span>(</span>
<span id="cb55-77"><a href="#cb55-77" aria-hidden="true" tabindex="-1"></a>               <span class="at">within =</span> <span class="st">'Current'</span>,</span>
<span id="cb55-78"><a href="#cb55-78" aria-hidden="true" tabindex="-1"></a>               <span class="at">on =</span> <span class="st">'R1alcoholunits'</span>,</span>
<span id="cb55-79"><a href="#cb55-79" aria-hidden="true" tabindex="-1"></a>               <span class="at">per =</span> <span class="dv">10</span>,</span>
<span id="cb55-80"><a href="#cb55-80" aria-hidden="true" tabindex="-1"></a>               <span class="at">reference_level =</span> <span class="dv">10</span>,</span>
<span id="cb55-81"><a href="#cb55-81" aria-hidden="true" tabindex="-1"></a>               <span class="at">by_missing_group =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">0</span>) </span>
<span id="cb55-82"><a href="#cb55-82" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb55-83"><a href="#cb55-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-84"><a href="#cb55-84" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb55-85"><a href="#cb55-85" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb55-86"><a href="#cb55-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-87"><a href="#cb55-87" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ACORN score</span></span>
<span id="cb55-88"><a href="#cb55-88" aria-hidden="true" tabindex="-1"></a>  <span class="st">'ses'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb55-89"><a href="#cb55-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'ACORN score'</span>,</span>
<span id="cb55-90"><a href="#cb55-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">trends =</span></span>
<span id="cb55-91"><a href="#cb55-91" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="st">'ACORN score'</span> <span class="ot">=</span></span>
<span id="cb55-92"><a href="#cb55-92" aria-hidden="true" tabindex="-1"></a>             <span class="fu">list</span>(</span>
<span id="cb55-93"><a href="#cb55-93" aria-hidden="true" tabindex="-1"></a>               <span class="at">on =</span> <span class="st">'ses'</span>,</span>
<span id="cb55-94"><a href="#cb55-94" aria-hidden="true" tabindex="-1"></a>               <span class="at">per =</span> <span class="dv">1</span>,</span>
<span id="cb55-95"><a href="#cb55-95" aria-hidden="true" tabindex="-1"></a>               <span class="at">reference_level =</span> <span class="st">'Wealthy achievers'</span>,</span>
<span id="cb55-96"><a href="#cb55-96" aria-hidden="true" tabindex="-1"></a>               <span class="at">by_missing_group =</span> <span class="fu">c</span>(<span class="st">'Region not covered'</span>, <span class="st">'Unclassified'</span>, <span class="cn">NA</span>)</span>
<span id="cb55-97"><a href="#cb55-97" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb55-98"><a href="#cb55-98" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb55-99"><a href="#cb55-99" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb55-100"><a href="#cb55-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-101"><a href="#cb55-101" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Parity</span></span>
<span id="cb55-102"><a href="#cb55-102" aria-hidden="true" tabindex="-1"></a>  <span class="st">'pregparous'</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb55-103"><a href="#cb55-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">realname =</span> <span class="st">'Pregnancies'</span>,</span>
<span id="cb55-104"><a href="#cb55-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">missing_group =</span> <span class="fu">c</span>(<span class="cn">NA</span>),</span>
<span id="cb55-105"><a href="#cb55-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">trends =</span></span>
<span id="cb55-106"><a href="#cb55-106" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="st">'Number of births'</span> <span class="ot">=</span></span>
<span id="cb55-107"><a href="#cb55-107" aria-hidden="true" tabindex="-1"></a>             <span class="fu">list</span>(</span>
<span id="cb55-108"><a href="#cb55-108" aria-hidden="true" tabindex="-1"></a>               <span class="at">within =</span> <span class="fu">c</span>(<span class="st">'Parous'</span>),</span>
<span id="cb55-109"><a href="#cb55-109" aria-hidden="true" tabindex="-1"></a>               <span class="at">on =</span> <span class="st">'pregparitycnt'</span>, </span>
<span id="cb55-110"><a href="#cb55-110" aria-hidden="true" tabindex="-1"></a>               <span class="at">per =</span> <span class="dv">1</span>,</span>
<span id="cb55-111"><a href="#cb55-111" aria-hidden="true" tabindex="-1"></a>               <span class="at">reference_level =</span> <span class="dv">2</span>,</span>
<span id="cb55-112"><a href="#cb55-112" aria-hidden="true" tabindex="-1"></a>               <span class="at">by_missing_group =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">0</span>)</span>
<span id="cb55-113"><a href="#cb55-113" aria-hidden="true" tabindex="-1"></a>             ),</span>
<span id="cb55-114"><a href="#cb55-114" aria-hidden="true" tabindex="-1"></a>           <span class="st">'Age at 1st pregnancy'</span> <span class="ot">=</span> </span>
<span id="cb55-115"><a href="#cb55-115" aria-hidden="true" tabindex="-1"></a>             <span class="fu">list</span>(</span>
<span id="cb55-116"><a href="#cb55-116" aria-hidden="true" tabindex="-1"></a>               <span class="at">within =</span> <span class="fu">c</span>(<span class="st">'Parous'</span>),</span>
<span id="cb55-117"><a href="#cb55-117" aria-hidden="true" tabindex="-1"></a>               <span class="at">on =</span> <span class="st">'age_at_pregdate_1_f'</span>,</span>
<span id="cb55-118"><a href="#cb55-118" aria-hidden="true" tabindex="-1"></a>               <span class="at">per =</span> <span class="dv">1</span>,</span>
<span id="cb55-119"><a href="#cb55-119" aria-hidden="true" tabindex="-1"></a>               <span class="at">reference_level =</span> <span class="dv">25</span>,</span>
<span id="cb55-120"><a href="#cb55-120" aria-hidden="true" tabindex="-1"></a>               <span class="at">by_missing_group =</span> <span class="fu">c</span>(<span class="cn">NA</span>)</span>
<span id="cb55-121"><a href="#cb55-121" aria-hidden="true" tabindex="-1"></a>               </span>
<span id="cb55-122"><a href="#cb55-122" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb55-123"><a href="#cb55-123" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb55-124"><a href="#cb55-124" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-125"><a href="#cb55-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-126"><a href="#cb55-126" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Timesplitting</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Currently working on this, have successfully implemented timesplitting on delivery dates (and increments 'parity'), follow-up questionnaire dates for smoking/alcohol/bmi, and HRT start/stop dates. Next is menopausal age.</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: HRT course dates have many ambiguities, thus how to manage these will need to be discussed.</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>split_individual <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data=</span>df, <span class="at">dates=</span>age_cols, <span class="at">applic_var=</span><span class="cn">NULL</span>, <span class="at">newvar=</span><span class="cn">NULL</span>, <span class="at">type =</span> <span class="cn">NULL</span>, <span class="at">tcode=</span><span class="cn">NULL</span>) {</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#browser()</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  ages <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(<span class="fu">unlist</span>(data[<span class="dv">1</span>, dates]))</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  split_df <span class="ot">&lt;-</span> data</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Delivery splits</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">'pregnancy'</span>) {</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    ages <span class="ot">&lt;-</span> ages[(ages <span class="sc">&gt;</span> <span class="fu">min</span>(data<span class="sc">$</span>fupca_start_age) <span class="sc">&amp;</span> ages <span class="sc">&lt;</span> <span class="fu">max</span>(data<span class="sc">$</span>c_age))]</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(ages) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> type <span class="sc">==</span> <span class="st">'pregnancy'</span>) {</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>      split_df<span class="sc">$</span>parity <span class="ot">&lt;-</span> split_df<span class="sc">$</span>pregparitycnt</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(split_df)</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    split_df <span class="ot">&lt;-</span> <span class="fu">survSplit</span>(split_df, <span class="at">cut =</span> ages, <span class="at">end =</span> <span class="st">"c_age"</span>, <span class="at">event =</span> <span class="st">"event"</span>, <span class="at">start =</span> <span class="st">"fupca_start_age"</span>,<span class="at">episode=</span><span class="st">"parity"</span>)</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>    split_df<span class="sc">$</span>parity <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(split_df<span class="sc">$</span>pregparitycnt), <span class="fu">na.omit</span>(split_df<span class="sc">$</span>parity<span class="dv">-1</span>) <span class="sc">+</span> split_df<span class="sc">$</span>pregparitycnt, <span class="cn">NA</span>) <span class="co"># How was pregparitycnt derived? Doesn't line up with dates per Reuben.</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">'recr_ages'</span>) { <span class="co"># Recruitment splits</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>      ages <span class="ot">&lt;-</span> ages[(ages <span class="sc">&gt;</span> <span class="fu">min</span>(data<span class="sc">$</span>fupca_start_age) <span class="sc">&amp;</span> ages <span class="sc">&lt;</span> <span class="fu">max</span>(data<span class="sc">$</span>c_age))]</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>      split_df <span class="ot">&lt;-</span> <span class="fu">survSplit</span>(split_df, <span class="at">cut =</span> ages, <span class="at">end =</span> <span class="st">"c_age"</span>, <span class="at">event =</span> <span class="st">"event"</span>, <span class="at">start =</span> <span class="st">"fupca_start_age"</span>)</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>      split_age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data[<span class="dv">1</span>, dates])</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>      subsequent_record <span class="ot">&lt;-</span> split_df[split_df<span class="sc">$</span>fupca_start_age <span class="sc">&gt;=</span> split_age,]</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(newvar <span class="cf">in</span> <span class="fu">names</span>(applic_var)) {</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>        prior_var <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(subsequent_record[<span class="dv">1</span>, applic_var[[newvar]][<span class="dv">1</span>]])</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>        subsequent_var <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data[<span class="dv">1</span>, applic_var[[newvar]][<span class="dv">2</span>]])</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>        split_df[[newvar]] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(split_df<span class="sc">$</span>fupca_start_age <span class="sc">&gt;=</span> split_age <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(subsequent_var), subsequent_var, prior_var) <span class="co"># Setting to prev value if new is NA, otherwise next</span></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">'hrt_ages_start'</span>) {</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.na</span>(split_df[[dates[<span class="dv">1</span>]]][<span class="dv">1</span>])) { <span class="co"># Handling missing first start age but present end age (? check for second/third course affected)</span></span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>      split_df[[dates[<span class="dv">1</span>]]] <span class="ot">=</span> (<span class="fu">min</span>(split_df<span class="sc">$</span>fupca_start_age) <span class="sc">+</span> split_df[[dates[<span class="dv">2</span>]]][<span class="dv">1</span>])<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>      ages <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(<span class="fu">unlist</span>(split_df[<span class="dv">1</span>, dates]))</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>    split_df <span class="ot">&lt;-</span> <span class="fu">survSplit</span>(split_df, <span class="at">cut =</span> ages, <span class="at">end =</span> <span class="st">"c_age"</span>, <span class="at">event =</span> <span class="st">"event"</span>, <span class="at">start =</span> <span class="st">"fupca_start_age"</span>)</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">#browser()</span></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(min(split_df$fupca_start_age))</span></span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>    split_df<span class="sc">$</span>hrt <span class="ot">&lt;-</span> split_df<span class="sc">$</span>hrtstatus</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(idx <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">2</span>)) {</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>      start_age <span class="ot">&lt;-</span> split_df[[dates[idx]]][<span class="dv">1</span>]</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>      stop_age <span class="ot">&lt;-</span> split_df[[dates[idx<span class="sc">+</span><span class="dv">1</span>]]][<span class="dv">1</span>]</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.na</span>(stop_age) <span class="sc">&amp;</span> <span class="fu">is.na</span>(start_age)) <span class="co"># Blank course</span></span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>      <span class="co">#if(!is.na(stop_age) &amp; stop_age &lt; min(split_df$fupca_start_age))</span></span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>          <span class="co">#  next</span></span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">is.na</span>(stop_age) <span class="sc">&amp;</span> start_age <span class="sc">&lt;</span> <span class="fu">min</span>(split_df<span class="sc">$</span>fupca_start_age)) </span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>          <span class="co">#stop_age &lt;- +Inf # To override hrtstatus, if hrtage &lt; startage</span></span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">next</span> <span class="co"># To use hrtstatus, if hrtage &lt; startage</span></span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>      <span class="co"># all remaining na(stopages) have hrtstart=nexthrtstart, we'll remove these</span></span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.na</span>(stop_age))</span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a>      interdate_rows <span class="ot">&lt;-</span> split_df<span class="sc">$</span>fupca_start_age <span class="sc">&gt;=</span> start_age <span class="sc">&amp;</span> split_df<span class="sc">$</span>c_age <span class="sc">&lt;=</span> stop_age</span>
<span id="cb56-62"><a href="#cb56-62" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">length</span>(interdate_rows) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb56-63"><a href="#cb56-63" aria-hidden="true" tabindex="-1"></a>        split_df<span class="sc">$</span>hrt[interdate_rows] <span class="ot">&lt;-</span> <span class="st">'Current'</span></span>
<span id="cb56-64"><a href="#cb56-64" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb56-65"><a href="#cb56-65" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-66"><a href="#cb56-66" aria-hidden="true" tabindex="-1"></a>      subsequent_rows <span class="ot">&lt;-</span> split_df<span class="sc">$</span>fupca_start_age <span class="sc">&gt;=</span> stop_age</span>
<span id="cb56-67"><a href="#cb56-67" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">length</span>(subsequent_rows) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb56-68"><a href="#cb56-68" aria-hidden="true" tabindex="-1"></a>        split_df<span class="sc">$</span>hrt[subsequent_rows] <span class="ot">&lt;-</span> <span class="st">'Former'</span></span>
<span id="cb56-69"><a href="#cb56-69" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb56-70"><a href="#cb56-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-71"><a href="#cb56-71" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-72"><a href="#cb56-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-73"><a href="#cb56-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(split_df)</span>
<span id="cb56-74"><a href="#cb56-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-75"><a href="#cb56-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-76"><a href="#cb56-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-77"><a href="#cb56-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Delivery age splits</span></span>
<span id="cb56-78"><a href="#cb56-78" aria-hidden="true" tabindex="-1"></a>pregdatecols <span class="ot">&lt;-</span> <span class="fu">colnames</span>(dataset_rf)[<span class="fu">grepl</span>(<span class="st">'^age_at_pregdate_</span><span class="sc">\\</span><span class="st">d'</span>, <span class="fu">colnames</span>(dataset_rf), <span class="at">perl =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb56-79"><a href="#cb56-79" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">merge</span>(dataset_surv_rf, dataset_rf <span class="sc">%&gt;%</span> <span class="fu">select</span>(TCode, pregdatecols[<span class="sc">-</span><span class="dv">1</span>]), <span class="at">by =</span> <span class="st">"TCode"</span>) <span class="co"># -1 because first is already in it</span></span>
<span id="cb56-80"><a href="#cb56-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-81"><a href="#cb56-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetching just people on HRT (for testing)</span></span>
<span id="cb56-82"><a href="#cb56-82" aria-hidden="true" tabindex="-1"></a><span class="co"># merged_data &lt;- merged_data %&gt;% filter(!is.na(HRTstartage_1))</span></span>
<span id="cb56-83"><a href="#cb56-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-84"><a href="#cb56-84" aria-hidden="true" tabindex="-1"></a>split_data <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span> </span>
<span id="cb56-85"><a href="#cb56-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TCode) <span class="sc">%&gt;%</span> </span>
<span id="cb56-86"><a href="#cb56-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span><span class="fu">split_individual</span>(.x, <span class="at">dates=</span>pregdatecols, <span class="at">type=</span><span class="st">'pregnancy'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb56-87"><a href="#cb56-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb56-88"><a href="#cb56-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-89"><a href="#cb56-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Recruitment age splits</span></span>
<span id="cb56-90"><a href="#cb56-90" aria-hidden="true" tabindex="-1"></a>split_data <span class="ot">&lt;-</span> split_data <span class="sc">%&gt;%</span> </span>
<span id="cb56-91"><a href="#cb56-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TCode) <span class="sc">%&gt;%</span> </span>
<span id="cb56-92"><a href="#cb56-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span><span class="fu">split_individual</span>(.x, <span class="at">dates=</span><span class="st">'age_at_QR2_date_f'</span>, <span class="at">applic_var=</span><span class="fu">list</span>(</span>
<span id="cb56-93"><a href="#cb56-93" aria-hidden="true" tabindex="-1"></a>    <span class="st">'bmi'</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'bodysizebminow'</span>, <span class="st">'R2bodysizebmi'</span>),</span>
<span id="cb56-94"><a href="#cb56-94" aria-hidden="true" tabindex="-1"></a>    <span class="st">'alcohol_status'</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'R1alcoholstatus'</span>, <span class="st">'R2alcoholstatus'</span>),</span>
<span id="cb56-95"><a href="#cb56-95" aria-hidden="true" tabindex="-1"></a>    <span class="st">'alcohol_units'</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'R1alcoholunits'</span>, <span class="st">'R2alcoholunits'</span>),</span>
<span id="cb56-96"><a href="#cb56-96" aria-hidden="true" tabindex="-1"></a>    <span class="st">'smoking_status'</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'R1smokingstatus'</span>, <span class="st">'R2smokingstatus'</span>)), <span class="at">type=</span><span class="st">'recr_ages'</span>)) <span class="sc">%&gt;%</span> <span class="co"># Always updating to what the next split says - even if 'illogical' (ie., from current drinker to never drinker)</span></span>
<span id="cb56-97"><a href="#cb56-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb56-98"><a href="#cb56-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-99"><a href="#cb56-99" aria-hidden="true" tabindex="-1"></a><span class="co"># HRT age splits</span></span>
<span id="cb56-100"><a href="#cb56-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-101"><a href="#cb56-101" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb56-102"><a href="#cb56-102" aria-hidden="true" tabindex="-1"></a><span class="do">## ISSUE 1: Start date before fup_start but "Never" HRT status (currently will overwrite their HRT status, or if end date is missing then it will trust their HRT status [then, issue becomes missing end date as discussed below])</span></span>
<span id="cb56-103"><a href="#cb56-103" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb56-104"><a href="#cb56-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-105"><a href="#cb56-105" aria-hidden="true" tabindex="-1"></a><span class="co"># never_but_started_before &lt;- dataset_surv_rf[!is.na(dataset_surv_rf$hrtstatus) &amp; dataset_surv_rf$hrtstatus == 'Never' &amp; !is.na(dataset_surv_rf$HRTstartage_1) &amp; dataset_surv_rf$HRTstartage_1 &lt; dataset_surv_rf$fupca_start_age,]</span></span>
<span id="cb56-106"><a href="#cb56-106" aria-hidden="true" tabindex="-1"></a><span class="co"># never_but_started_before_hrt &lt;- never_but_started_before %&gt;%</span></span>
<span id="cb56-107"><a href="#cb56-107" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(TCode) %&gt;%</span></span>
<span id="cb56-108"><a href="#cb56-108" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_modify(~split_individual(.x, dates=c('HRTstartage_1', 'HRTendage_1',</span></span>
<span id="cb56-109"><a href="#cb56-109" aria-hidden="true" tabindex="-1"></a><span class="co">#                                              'HRTstartage_2', 'HRTendage_2',</span></span>
<span id="cb56-110"><a href="#cb56-110" aria-hidden="true" tabindex="-1"></a><span class="co">#                                              'HRTstartage_3', 'HRTendage_3',</span></span>
<span id="cb56-111"><a href="#cb56-111" aria-hidden="true" tabindex="-1"></a><span class="co">#                                              'HRTstartage_4', 'HRTendage_4'), type='hrt_ages_start')) %&gt;%</span></span>
<span id="cb56-112"><a href="#cb56-112" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup()</span></span>
<span id="cb56-113"><a href="#cb56-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-114"><a href="#cb56-114" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb56-115"><a href="#cb56-115" aria-hidden="true" tabindex="-1"></a><span class="do">## ISSUE 2: Missing start with non-missing end (not sure how to handle this)</span></span>
<span id="cb56-116"><a href="#cb56-116" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb56-117"><a href="#cb56-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-118"><a href="#cb56-118" aria-hidden="true" tabindex="-1"></a><span class="co"># interested_rows &lt;- dataset_surv_rf[is.na(dataset_surv_rf$HRTstartage_1) &amp; !is.na(dataset_surv_rf$HRTendage_1),]</span></span>
<span id="cb56-119"><a href="#cb56-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-120"><a href="#cb56-120" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb56-121"><a href="#cb56-121" aria-hidden="true" tabindex="-1"></a><span class="do">## ISSUE 3: Missing end with non-missing start (not sure how to handle this)</span></span>
<span id="cb56-122"><a href="#cb56-122" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb56-123"><a href="#cb56-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-124"><a href="#cb56-124" aria-hidden="true" tabindex="-1"></a>interested_rows <span class="ot">&lt;-</span> dataset_surv_rf[<span class="fu">is.na</span>(dataset_surv_rf<span class="sc">$</span>HRTendage_1) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(dataset_surv_rf<span class="sc">$</span>HRTstartage_1), ]</span>
<span id="cb56-125"><a href="#cb56-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-126"><a href="#cb56-126" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb56-127"><a href="#cb56-127" aria-hidden="true" tabindex="-1"></a><span class="do">## ISSUE 4: Conflicting HRT end ages (my current algo will set the entire period to Former user)</span></span>
<span id="cb56-128"><a href="#cb56-128" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb56-129"><a href="#cb56-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-130"><a href="#cb56-130" aria-hidden="true" tabindex="-1"></a><span class="co"># interested_rows &lt;- dataset_surv_rf[!is.na(dataset_surv_rf$HRTendage_2) &amp; is.na(dataset_surv_rf$HRTstartage_2), ]</span></span>
<span id="cb56-131"><a href="#cb56-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-132"><a href="#cb56-132" aria-hidden="true" tabindex="-1"></a>interested_rows <span class="ot">&lt;-</span> interested_rows <span class="sc">%&gt;%</span></span>
<span id="cb56-133"><a href="#cb56-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TCode) <span class="sc">%&gt;%</span></span>
<span id="cb56-134"><a href="#cb56-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span><span class="fu">split_individual</span>(.x, <span class="at">dates=</span><span class="fu">c</span>(<span class="st">'HRTstartage_1'</span>, <span class="st">'HRTendage_1'</span>,</span>
<span id="cb56-135"><a href="#cb56-135" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">'HRTstartage_2'</span>, <span class="st">'HRTendage_2'</span>,</span>
<span id="cb56-136"><a href="#cb56-136" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">'HRTstartage_3'</span>, <span class="st">'HRTendage_3'</span>,</span>
<span id="cb56-137"><a href="#cb56-137" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">'HRTstartage_4'</span>, <span class="st">'HRTendage_4'</span>), <span class="at">type=</span><span class="st">'hrt_ages_start'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb56-138"><a href="#cb56-138" aria-hidden="true" tabindex="-1"></a> <span class="fu">ungroup</span>()</span>
<span id="cb56-139"><a href="#cb56-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-140"><a href="#cb56-140" aria-hidden="true" tabindex="-1"></a><span class="co"># For viewing datasets for debugging:</span></span>
<span id="cb56-141"><a href="#cb56-141" aria-hidden="true" tabindex="-1"></a><span class="co"># View(m_start_nm_end_proc[, c('TCode', 'fupca_start_age', 'c_age', 'hrtstatus', 'hrt', 'HRTstartage_1', 'HRTendage_1', 'HRTstartage_2', 'HRTendage_2', 'HRTstartage_3', 'HRTendage_3', 'HRTstartage_4', 'HRTendage_4')])</span></span>
<span id="cb56-142"><a href="#cb56-142" aria-hidden="true" tabindex="-1"></a><span class="co"># # It will recode hrt to be Current</span></span>
<span id="cb56-143"><a href="#cb56-143" aria-hidden="true" tabindex="-1"></a><span class="co"># View(m_start_nm_end[, c('TCode', 'fupca_start_age', 'c_age', 'hrtstatus', 'HRTstartage_1', 'HRTendage_1', 'HRTstartage_2', 'HRTendage_2', 'HRTstartage_3', 'HRTendage_3', 'HRTstartage_4', 'HRTendage_4')])</span></span>
<span id="cb56-144"><a href="#cb56-144" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb56-145"><a href="#cb56-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-146"><a href="#cb56-146" aria-hidden="true" tabindex="-1"></a>split_data <span class="ot">&lt;-</span> split_data <span class="sc">%&gt;%</span> </span>
<span id="cb56-147"><a href="#cb56-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TCode) <span class="sc">%&gt;%</span> </span>
<span id="cb56-148"><a href="#cb56-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span><span class="fu">split_individual</span>(.x, <span class="at">dates=</span><span class="fu">c</span>(<span class="st">'HRTstartage_1'</span>, <span class="st">'HRTendage_1'</span>, </span>
<span id="cb56-149"><a href="#cb56-149" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">'HRTstartage_2'</span>, <span class="st">'HRTendage_2'</span>,</span>
<span id="cb56-150"><a href="#cb56-150" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">'HRTstartage_3'</span>, <span class="st">'HRTendage_3'</span>,</span>
<span id="cb56-151"><a href="#cb56-151" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">'HRTstartage_4'</span>, <span class="st">'HRTendage_4'</span>), <span class="at">type=</span><span class="st">'hrt_ages_start'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-152"><a href="#cb56-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb56-153"><a href="#cb56-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-154"><a href="#cb56-154" aria-hidden="true" tabindex="-1"></a><span class="co"># Next is to split on menopausal age</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Analysis (using configuration)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This code is currently using non-timesplit data.</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>analysis_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(rf <span class="cf">in</span> <span class="fu">names</span>(analysis_config)) {</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  rfac <span class="ot">&lt;-</span> analysis_config[[rf]]</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  temp_rf <span class="ot">&lt;-</span> dataset_surv_rf[,<span class="fu">c</span>(rf, <span class="st">'fupca_start_age'</span>, <span class="st">'c_age'</span>, <span class="st">'event'</span>)]</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(rfac<span class="sc">$</span>trends)) {</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.factor</span>(temp_rf[[rf]])) {</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'Log for variable </span><span class="sc">\'</span><span class="st">'</span>, rf, <span class="st">'</span><span class="sc">\'</span><span class="st">: this is a continuous variable and you did not configure a trend, thus it will be auto-configured.'</span>))</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>      rfac<span class="sc">$</span>trends <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">rf =</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>           <span class="fu">list</span>(</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">on =</span> rf,</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">by_missing_group =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.null</span>(rfac<span class="sc">$</span>missing_group), missing_group, <span class="cn">NULL</span>) </span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Sanity checking the missing_group variable</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(rfac<span class="sc">$</span>missing_group)) {</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.factor</span>(temp_rf[[rf]])) { </span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add a new level for missing groups in the factor variable</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>      new_level <span class="ot">&lt;-</span> <span class="st">"Missing"</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">levels</span>(temp_rf[[rf]]) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">levels</span>(temp_rf[[rf]]), new_level)</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>      temp_rf[[rf]][temp_rf[[rf]] <span class="sc">%in%</span> rfac<span class="sc">$</span>missing_group] <span class="ot">&lt;-</span> new_level</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.null</span>(rfac<span class="sc">$</span>trend)) {</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'Error for variable </span><span class="sc">\'</span><span class="st">'</span>, rf, <span class="st">'</span><span class="sc">\'</span><span class="st">: this is a continuous variable and you have specified a missing category, but you have not configured a trend'</span>))</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">is.null</span>(rfac<span class="sc">$</span>trends)) {</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'Warning for variable </span><span class="sc">\'</span><span class="st">'</span>, rf, <span class="st">'</span><span class="sc">\'</span><span class="st">: you have not specified a missing group; complete case analysis will be performed.'</span>))</span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(rfac<span class="sc">$</span>trends) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">any</span>(<span class="fu">sapply</span>(rfac<span class="sc">$</span>trends, <span class="cf">function</span>(x) x<span class="sc">$</span>on<span class="sc">==</span>rf <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(x<span class="sc">$</span>by_missing_group)))) {</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'Warning for variable </span><span class="sc">\'</span><span class="st">'</span>, rf, <span class="st">'</span><span class="sc">\'</span><span class="st">: you have not specified a missing group (within a trend variable); complete case analysis will be performed.'</span>))</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Loop for fitting a trend</span></span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(rfac<span class="sc">$</span>trends)) { </span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set baseline formula</span></span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>    formula <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>    autotrend <span class="ot">=</span> <span class="cn">FALSE</span> <span class="co"># To check if any trend is on the parent risk factor itself.</span></span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(trend <span class="cf">in</span> <span class="fu">names</span>(rfac<span class="sc">$</span>trends)) {</span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a>      trend_config <span class="ot">&lt;-</span> rfac<span class="sc">$</span>trends[[trend]]</span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a>      within <span class="ot">&lt;-</span> trend_config<span class="sc">$</span>within</span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a>      on <span class="ot">&lt;-</span> trend_config<span class="sc">$</span>on</span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a>      per <span class="ot">&lt;-</span> trend_config<span class="sc">$</span>per</span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a>      reference_level <span class="ot">&lt;-</span> trend_config<span class="sc">$</span>reference_level</span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a>      by_missing_group <span class="ot">&lt;-</span> trend_config<span class="sc">$</span>by_missing_group</span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a>      <span class="do">##</span></span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a>      <span class="do">## Setting the mask on the risk factor dictating the observations to attend to for determining the trend.</span></span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a>      <span class="do">##</span></span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(within) <span class="sc">&amp;&amp;</span> (within <span class="sc">!=</span> rf)) {</span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.factor</span>(temp_rf[[rf]])) {</span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a>          <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'Error for variable </span><span class="sc">\'</span><span class="st">'</span>, rf, <span class="st">'</span><span class="sc">\'</span><span class="st">: you specified a level to perform a trend within, but risk factor is a continuous variable.'</span>))</span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a>          <span class="cf">next</span></span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a>        temp_rf[[<span class="fu">paste0</span>(within, <span class="st">"Mask"</span>)]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(temp_rf[[rf]] <span class="sc">%in%</span> within)</span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a>        within <span class="ot">&lt;-</span> rf</span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a>        temp_rf[[<span class="fu">paste0</span>(within, <span class="st">"Mask"</span>)]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a>      <span class="do">##</span></span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>      <span class="do">## Setting up the trend variable (ie., the variable on which to fit a trend)</span></span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a>      <span class="do">##</span></span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(on)) {</span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(on <span class="sc">==</span> rf) {</span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a>          autotrend <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.ordered</span>(temp_rf[[on]]) <span class="sc">&amp;</span> <span class="fu">is.factor</span>(temp_rf[[on]])) {</span>
<span id="cb57-87"><a href="#cb57-87" aria-hidden="true" tabindex="-1"></a>          <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'Error for variable </span><span class="sc">\'</span><span class="st">'</span>, rf, <span class="st">'</span><span class="sc">\'</span><span class="st">: you have specified a trend on a categorical variable, but this variable is unordered.'</span>))</span>
<span id="cb57-88"><a href="#cb57-88" aria-hidden="true" tabindex="-1"></a>          <span class="cf">next</span></span>
<span id="cb57-89"><a href="#cb57-89" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb57-90"><a href="#cb57-90" aria-hidden="true" tabindex="-1"></a>        temp_rf <span class="ot">&lt;-</span> <span class="fu">cbind</span>(temp_rf, dataset_surv_rf[,<span class="fu">c</span>(on)])</span>
<span id="cb57-91"><a href="#cb57-91" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(temp_rf)[<span class="fu">ncol</span>(temp_rf)] <span class="ot">&lt;-</span> trend</span>
<span id="cb57-92"><a href="#cb57-92" aria-hidden="true" tabindex="-1"></a>        on <span class="ot">&lt;-</span> trend <span class="co"># For more intuitive coefficient naming</span></span>
<span id="cb57-93"><a href="#cb57-93" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb57-94"><a href="#cb57-94" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'Error for variable </span><span class="sc">\'</span><span class="st">'</span>, rf, <span class="st">'</span><span class="sc">\'</span><span class="st">: you have specified a trend, but not specified which variable to perform the trend on'</span>))</span>
<span id="cb57-95"><a href="#cb57-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb57-96"><a href="#cb57-96" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb57-97"><a href="#cb57-97" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-98"><a href="#cb57-98" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(per) <span class="sc">&amp;</span> <span class="fu">is.ordered</span>(temp_rf[[on]]) <span class="sc">&amp;</span> per <span class="sc">!=</span> <span class="dv">1</span>) {</span>
<span id="cb57-99"><a href="#cb57-99" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'Error for variable </span><span class="sc">\'</span><span class="st">'</span>, rf, <span class="st">'</span><span class="sc">\'</span><span class="st">: you have specified a </span><span class="sc">\'</span><span class="st">per</span><span class="sc">\'</span><span class="st"> != 1 on an ordered factor, which is not yet implemented.'</span>))</span>
<span id="cb57-100"><a href="#cb57-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb57-101"><a href="#cb57-101" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb57-102"><a href="#cb57-102" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-103"><a href="#cb57-103" aria-hidden="true" tabindex="-1"></a>      <span class="do">##</span></span>
<span id="cb57-104"><a href="#cb57-104" aria-hidden="true" tabindex="-1"></a>      <span class="do">## Sanity checking the by_missing_group variable, ie., the values of the trend variable which should be considered 'missing'</span></span>
<span id="cb57-105"><a href="#cb57-105" aria-hidden="true" tabindex="-1"></a>      <span class="do">##</span></span>
<span id="cb57-106"><a href="#cb57-106" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-107"><a href="#cb57-107" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(by_missing_group)) {</span>
<span id="cb57-108"><a href="#cb57-108" aria-hidden="true" tabindex="-1"></a>        temp_rf[[<span class="fu">paste0</span>(on, <span class="st">"Missing"</span>)]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>((temp_rf[[on]] <span class="sc">%in%</span> by_missing_group))</span>
<span id="cb57-109"><a href="#cb57-109" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb57-110"><a href="#cb57-110" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'Warning for variable </span><span class="sc">\'</span><span class="st">'</span>, rf, <span class="st">'</span><span class="sc">\'</span><span class="st">: you have specified a trend, but did not specify what constitute missing values; complete case analysis will be performed.'</span>))</span>
<span id="cb57-111"><a href="#cb57-111" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb57-112"><a href="#cb57-112" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-113"><a href="#cb57-113" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Set reference level according to numeric value, and convert categories to numeric</span></span>
<span id="cb57-114"><a href="#cb57-114" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.ordered</span>(temp_rf[[on]])) { </span>
<span id="cb57-115"><a href="#cb57-115" aria-hidden="true" tabindex="-1"></a>        reference_level <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">levels</span>(temp_rf[[on]]) <span class="sc">==</span> reference_level)</span>
<span id="cb57-116"><a href="#cb57-116" aria-hidden="true" tabindex="-1"></a>        temp_rf[[on]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(temp_rf[[on]]))</span>
<span id="cb57-117"><a href="#cb57-117" aria-hidden="true" tabindex="-1"></a>      } </span>
<span id="cb57-118"><a href="#cb57-118" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-119"><a href="#cb57-119" aria-hidden="true" tabindex="-1"></a>      formula <span class="ot">&lt;-</span> <span class="fu">paste0</span>(formula, <span class="st">" + "</span>, within, <span class="st">"Mask:`"</span>, on, <span class="st">"`"</span>)</span>
<span id="cb57-120"><a href="#cb57-120" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-121"><a href="#cb57-121" aria-hidden="true" tabindex="-1"></a>      temp_rf[[on]] <span class="ot">&lt;-</span> temp_rf[[on]] <span class="sc">-</span> reference_level</span>
<span id="cb57-122"><a href="#cb57-122" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-123"><a href="#cb57-123" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Divide continuous variable by 'per'</span></span>
<span id="cb57-124"><a href="#cb57-124" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.ordered</span>(temp_rf[[on]]) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(per)) { </span>
<span id="cb57-125"><a href="#cb57-125" aria-hidden="true" tabindex="-1"></a>        temp_rf[[on]] <span class="ot">&lt;-</span> temp_rf[[on]]<span class="sc">/</span>per</span>
<span id="cb57-126"><a href="#cb57-126" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb57-127"><a href="#cb57-127" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-128"><a href="#cb57-128" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add missing group on trend variable, if specified</span></span>
<span id="cb57-129"><a href="#cb57-129" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(by_missing_group)) {</span>
<span id="cb57-130"><a href="#cb57-130" aria-hidden="true" tabindex="-1"></a>        temp_rf[[on]][temp_rf[[<span class="fu">paste0</span>(on, <span class="st">"Missing"</span>)]] <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb57-131"><a href="#cb57-131" aria-hidden="true" tabindex="-1"></a>        formula <span class="ot">&lt;-</span> <span class="fu">paste0</span>(formula, <span class="st">" + "</span>, <span class="fu">paste0</span>(within, <span class="st">"Mask:`"</span>, on, <span class="st">"Missing`"</span>))</span>
<span id="cb57-132"><a href="#cb57-132" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb57-133"><a href="#cb57-133" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-134"><a href="#cb57-134" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-135"><a href="#cb57-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span>autotrend) { <span class="co"># or !include_root_rf</span></span>
<span id="cb57-136"><a href="#cb57-136" aria-hidden="true" tabindex="-1"></a>      formula <span class="ot">&lt;-</span> <span class="fu">paste0</span>(formula, <span class="st">" + "</span>, rf)</span>
<span id="cb57-137"><a href="#cb57-137" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-138"><a href="#cb57-138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-139"><a href="#cb57-139" aria-hidden="true" tabindex="-1"></a>    formula <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Surv(fupca_start_age, c_age, event) ~ "</span>, <span class="fu">sub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">+"</span>, <span class="st">""</span>, formula))</span>
<span id="cb57-140"><a href="#cb57-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-141"><a href="#cb57-141" aria-hidden="true" tabindex="-1"></a>    formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(formula)</span>
<span id="cb57-142"><a href="#cb57-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-143"><a href="#cb57-143" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> { <span class="co"># Fitting a categorical variable without trend</span></span>
<span id="cb57-144"><a href="#cb57-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-145"><a href="#cb57-145" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Unordering the factor</span></span>
<span id="cb57-146"><a href="#cb57-146" aria-hidden="true" tabindex="-1"></a>    temp_rf[[rf]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(temp_rf[[rf]], <span class="at">levels =</span> <span class="fu">levels</span>(temp_rf[[rf]]), <span class="at">ordered =</span> <span class="cn">FALSE</span>)</span>
<span id="cb57-147"><a href="#cb57-147" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-148"><a href="#cb57-148" aria-hidden="true" tabindex="-1"></a>    formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"Surv(fupca_start_age, c_age, event) ~ "</span>, rf))</span>
<span id="cb57-149"><a href="#cb57-149" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-150"><a href="#cb57-150" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-151"><a href="#cb57-151" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-152"><a href="#cb57-152" aria-hidden="true" tabindex="-1"></a>  cox_model <span class="ot">&lt;-</span> <span class="fu">coxph</span>(formula, <span class="at">data =</span> temp_rf)</span>
<span id="cb57-153"><a href="#cb57-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-154"><a href="#cb57-154" aria-hidden="true" tabindex="-1"></a>  exp_coef <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">coef</span>(cox_model))</span>
<span id="cb57-155"><a href="#cb57-155" aria-hidden="true" tabindex="-1"></a>  conf_int <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">confint</span>(cox_model))</span>
<span id="cb57-156"><a href="#cb57-156" aria-hidden="true" tabindex="-1"></a>  conf_int_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(conf_int), <span class="cf">function</span>(i) conf_int[i, ])</span>
<span id="cb57-157"><a href="#cb57-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(conf_int_list) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(conf_int)</span>
<span id="cb57-158"><a href="#cb57-158" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-159"><a href="#cb57-159" aria-hidden="true" tabindex="-1"></a>  p_values <span class="ot">&lt;-</span> <span class="fu">summary</span>(cox_model)<span class="sc">$</span>coefficients[, <span class="st">"Pr(&gt;|z|)"</span>]</span>
<span id="cb57-160"><a href="#cb57-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-161"><a href="#cb57-161" aria-hidden="true" tabindex="-1"></a>  analysis_results[[rfac<span class="sc">$</span>realname]] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"Variable name"</span> <span class="ot">=</span> rf,</span>
<span id="cb57-162"><a href="#cb57-162" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Baseline group (for categorical)"</span> <span class="ot">=</span> <span class="fu">levels</span>(temp_rf[[rf]])[<span class="dv">1</span>],</span>
<span id="cb57-163"><a href="#cb57-163" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Reference groups (for trend)"</span> <span class="ot">=</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(rfac<span class="sc">$</span>trends)) {</span>
<span id="cb57-164"><a href="#cb57-164" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">setNames</span>(<span class="fu">lapply</span>(rfac<span class="sc">$</span>trends, <span class="cf">function</span>(x) x<span class="sc">$</span>reference_level), <span class="fu">sapply</span>(rfac<span class="sc">$</span>trends, <span class="cf">function</span>(x) x<span class="sc">$</span>on)) </span>
<span id="cb57-165"><a href="#cb57-165" aria-hidden="true" tabindex="-1"></a>                                 } <span class="cf">else</span> { </span>
<span id="cb57-166"><a href="#cb57-166" aria-hidden="true" tabindex="-1"></a>                                   <span class="cn">NA</span> </span>
<span id="cb57-167"><a href="#cb57-167" aria-hidden="true" tabindex="-1"></a>                                 },</span>
<span id="cb57-168"><a href="#cb57-168" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Cox model"</span> <span class="ot">=</span> cox_model,</span>
<span id="cb57-169"><a href="#cb57-169" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Coefficients"</span> <span class="ot">=</span> exp_coef, </span>
<span id="cb57-170"><a href="#cb57-170" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Confidence Intervals"</span> <span class="ot">=</span> conf_int_list,</span>
<span id="cb57-171"><a href="#cb57-171" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"P-values"</span> <span class="ot">=</span> p_values)</span>
<span id="cb57-172"><a href="#cb57-172" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-173"><a href="#cb57-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-174"><a href="#cb57-174" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(analysis_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`Family history of breast cancer`
$`Family history of breast cancer`$`Variable name`
[1] "fambrca"

$`Family history of breast cancer`$`Baseline group (for categorical)`
[1] "Absent"

$`Family history of breast cancer`$`Reference groups (for trend)`
[1] NA

$`Family history of breast cancer`$`Cox model`
Call:
coxph(formula = formula, data = temp_rf)

                  coef exp(coef) se(coef)     z      p
fambrcaPresent 0.53857   1.71356  0.03834 14.05 &lt;2e-16
fambrcaMissing      NA        NA  0.00000    NA     NA

Likelihood ratio test=179.4  on 1 df, p=&lt; 2.2e-16
n= 104694, number of events= 3633 

$`Family history of breast cancer`$Coefficients
fambrcaPresent fambrcaMissing 
      1.713555             NA 

$`Family history of breast cancer`$`Confidence Intervals`
$`Family history of breast cancer`$`Confidence Intervals`$fambrcaPresent
  2.5 %  97.5 % 
1.58952 1.84727 

$`Family history of breast cancer`$`Confidence Intervals`$fambrcaMissing
 2.5 % 97.5 % 
    NA     NA 


$`Family history of breast cancer`$`P-values`
fambrcaPresent fambrcaMissing 
  7.873662e-45             NA 


$`History of benign breast disease`
$`History of benign breast disease`$`Variable name`
[1] "brbendis"

$`History of benign breast disease`$`Baseline group (for categorical)`
[1] "No"

$`History of benign breast disease`$`Reference groups (for trend)`
[1] NA

$`History of benign breast disease`$`Cox model`
Call:
coxph(formula = formula, data = temp_rf)

                   coef exp(coef) se(coef)     z      p
brbendisYes     0.40967   1.50632  0.03642 11.25 &lt;2e-16
brbendisMissing      NA        NA  0.00000    NA     NA

Likelihood ratio test=119.8  on 1 df, p=&lt; 2.2e-16
n= 104694, number of events= 3633 

$`History of benign breast disease`$Coefficients
    brbendisYes brbendisMissing 
       1.506322              NA 

$`History of benign breast disease`$`Confidence Intervals`
$`History of benign breast disease`$`Confidence Intervals`$brbendisYes
   2.5 %   97.5 % 
1.402560 1.617761 

$`History of benign breast disease`$`Confidence Intervals`$brbendisMissing
 2.5 % 97.5 % 
    NA     NA 


$`History of benign breast disease`$`P-values`
    brbendisYes brbendisMissing 
   2.314871e-29              NA 


$`BMI at age 20`
$`BMI at age 20`$`Variable name`
[1] "bodysizebmi20"

$`BMI at age 20`$`Baseline group (for categorical)`
NULL

$`BMI at age 20`$`Reference groups (for trend)`
$`BMI at age 20`$`Reference groups (for trend)`$bodysizebmi20
[1] 22.5


$`BMI at age 20`$`Cox model`
Call:
coxph(formula = formula, data = temp_rf)

                                                          coef exp(coef)
bodysizebmi20Mask:`Trend by unit BMI increase`        -0.03103   0.96945
bodysizebmi20Mask:`Trend by unit BMI increaseMissing` -0.03195   0.96855
                                                      se(coef)      z         p
bodysizebmi20Mask:`Trend by unit BMI increase`         0.00705 -4.401 0.0000108
bodysizebmi20Mask:`Trend by unit BMI increaseMissing`  0.04443 -0.719     0.472

Likelihood ratio test=22.35  on 2 df, p=0.00001399
n= 104694, number of events= 3633 

$`BMI at age 20`$Coefficients
       bodysizebmi20Mask:`Trend by unit BMI increase` 
                                            0.9694492 
bodysizebmi20Mask:`Trend by unit BMI increaseMissing` 
                                            0.9685533 

$`BMI at age 20`$`Confidence Intervals`
$`BMI at age 20`$`Confidence Intervals`$`bodysizebmi20Mask:`Trend by unit BMI increase``
    2.5 %    97.5 % 
0.9561448 0.9829387 

$`BMI at age 20`$`Confidence Intervals`$`bodysizebmi20Mask:`Trend by unit BMI increaseMissing``
    2.5 %    97.5 % 
0.8877728 1.0566841 


$`BMI at age 20`$`P-values`
       bodysizebmi20Mask:`Trend by unit BMI increase` 
                                        0.00001078927 
bodysizebmi20Mask:`Trend by unit BMI increaseMissing` 
                                        0.47208153171 


$BMI
$BMI$`Variable name`
[1] "bodysizebminow"

$BMI$`Baseline group (for categorical)`
NULL

$BMI$`Reference groups (for trend)`
$BMI$`Reference groups (for trend)`$bodysizebminow
[1] 22.5


$BMI$`Cox model`
Call:
coxph(formula = formula, data = temp_rf)

                                                            coef exp(coef)
bodysizebminowMask:`Trend by unit BMI increase`         0.002926  1.002930
bodysizebminowMask:`Trend by unit BMI increaseMissing` -0.231572  0.793285
                                                        se(coef)      z     p
bodysizebminowMask:`Trend by unit BMI increase`         0.003701  0.791 0.429
bodysizebminowMask:`Trend by unit BMI increaseMissing`  0.123103 -1.881 0.060

Likelihood ratio test=4.77  on 2 df, p=0.0922
n= 104694, number of events= 3633 

$BMI$Coefficients
       bodysizebminowMask:`Trend by unit BMI increase` 
                                             1.0029302 
bodysizebminowMask:`Trend by unit BMI increaseMissing` 
                                             0.7932853 

$BMI$`Confidence Intervals`
$BMI$`Confidence Intervals`$`bodysizebminowMask:`Trend by unit BMI increase``
   2.5 %   97.5 % 
0.995681 1.010232 

$BMI$`Confidence Intervals`$`bodysizebminowMask:`Trend by unit BMI increaseMissing``
    2.5 %    97.5 % 
0.6232231 1.0097531 


$BMI$`P-values`
       bodysizebminowMask:`Trend by unit BMI increase` 
                                             0.4292262 
bodysizebminowMask:`Trend by unit BMI increaseMissing` 
                                             0.0599555 


$`Age at menarche`
$`Age at menarche`$`Variable name`
[1] "menarcheage"

$`Age at menarche`$`Baseline group (for categorical)`
NULL

$`Age at menarche`$`Reference groups (for trend)`
$`Age at menarche`$`Reference groups (for trend)`$menarcheage
[1] 13


$`Age at menarche`$`Cox model`
Call:
coxph(formula = formula, data = temp_rf)

                                                     coef exp(coef) se(coef)
menarcheageMask:`Trend by age (per year)`        -0.02170   0.97853  0.01189
menarcheageMask:`Trend by age (per year)Missing` -0.03515   0.96546  0.05657
                                                      z     p
menarcheageMask:`Trend by age (per year)`        -1.825 0.068
menarcheageMask:`Trend by age (per year)Missing` -0.621 0.534

Likelihood ratio test=3.91  on 2 df, p=0.1419
n= 104694, number of events= 3633 

$`Age at menarche`$Coefficients
       menarcheageMask:`Trend by age (per year)` 
                                       0.9785306 
menarcheageMask:`Trend by age (per year)Missing` 
                                       0.9654638 

$`Age at menarche`$`Confidence Intervals`
$`Age at menarche`$`Confidence Intervals`$`menarcheageMask:`Trend by age (per year)``
    2.5 %    97.5 % 
0.9559851 1.0016077 

$`Age at menarche`$`Confidence Intervals`$`menarcheageMask:`Trend by age (per year)Missing``
    2.5 %    97.5 % 
0.8641414 1.0786663 


$`Age at menarche`$`P-values`
       menarcheageMask:`Trend by age (per year)` 
                                      0.06801799 
menarcheageMask:`Trend by age (per year)Missing` 
                                      0.53439358 


$Alcohol
$Alcohol$`Variable name`
[1] "R1alcoholstatus"

$Alcohol$`Baseline group (for categorical)`
[1] "Never"

$Alcohol$`Reference groups (for trend)`
$Alcohol$`Reference groups (for trend)`$R1alcoholunits
[1] 10


$Alcohol$`Cox model`
Call:
coxph(formula = formula, data = temp_rf)

                                                           coef exp(coef)
R1alcoholstatusCurrent                                  0.11311   1.11975
R1alcoholstatusPast                                     0.11693   1.12404
R1alcoholstatusMissing                                       NA        NA
CurrentMask:`Alcohol consumption (per 10 units)`        0.04763   1.04878
CurrentMask:`Alcohol consumption (per 10 units)Missing` 0.12600   1.13428
                                                        se(coef)     z        p
R1alcoholstatusCurrent                                   0.05139 2.201 0.027724
R1alcoholstatusPast                                      0.06098 1.918 0.055162
R1alcoholstatusMissing                                   0.00000    NA       NA
CurrentMask:`Alcohol consumption (per 10 units)`         0.01308 3.641 0.000272
CurrentMask:`Alcohol consumption (per 10 units)Missing`  0.12819 0.983 0.325650

Likelihood ratio test=22.16  on 4 df, p=0.0001863
n= 104694, number of events= 3633 

$Alcohol$Coefficients
                                 R1alcoholstatusCurrent 
                                               1.119752 
                                    R1alcoholstatusPast 
                                               1.124037 
                                 R1alcoholstatusMissing 
                                                     NA 
       CurrentMask:`Alcohol consumption (per 10 units)` 
                                               1.048779 
CurrentMask:`Alcohol consumption (per 10 units)Missing` 
                                               1.134283 

$Alcohol$`Confidence Intervals`
$Alcohol$`Confidence Intervals`$R1alcoholstatusCurrent
   2.5 %   97.5 % 
1.012472 1.238401 

$Alcohol$`Confidence Intervals`$R1alcoholstatusPast
    2.5 %    97.5 % 
0.9974198 1.2667276 

$Alcohol$`Confidence Intervals`$R1alcoholstatusMissing
 2.5 % 97.5 % 
    NA     NA 

$Alcohol$`Confidence Intervals`$`CurrentMask:`Alcohol consumption (per 10 units)``
   2.5 %   97.5 % 
1.022232 1.076016 

$Alcohol$`Confidence Intervals`$`CurrentMask:`Alcohol consumption (per 10 units)Missing``
    2.5 %    97.5 % 
0.8822766 1.4582714 


$Alcohol$`P-values`
                                 R1alcoholstatusCurrent 
                                           0.0277239307 
                                    R1alcoholstatusPast 
                                           0.0551624698 
                                 R1alcoholstatusMissing 
                                                     NA 
       CurrentMask:`Alcohol consumption (per 10 units)` 
                                           0.0002716448 
CurrentMask:`Alcohol consumption (per 10 units)Missing` 
                                           0.3256504476 


$`ACORN score`
$`ACORN score`$`Variable name`
[1] "ses"

$`ACORN score`$`Baseline group (for categorical)`
[1] "Wealthy achievers"

$`ACORN score`$`Reference groups (for trend)`
$`ACORN score`$`Reference groups (for trend)`$ses
[1] "Wealthy achievers"


$`ACORN score`$`Cox model`
Call:
coxph(formula = formula, data = temp_rf)

                                 coef exp(coef) se(coef)      z       p
sesMask:`ACORN score`        -0.04341   0.95752  0.01393 -3.116 0.00183
sesMask:`ACORN scoreMissing` -0.34923   0.70523  0.21932 -1.592 0.11131

Likelihood ratio test=11.98  on 2 df, p=0.002502
n= 104694, number of events= 3633 

$`ACORN score`$Coefficients
       sesMask:`ACORN score` sesMask:`ACORN scoreMissing` 
                   0.9575219                    0.7052296 

$`ACORN score`$`Confidence Intervals`
$`ACORN score`$`Confidence Intervals`$`sesMask:`ACORN score``
    2.5 %    97.5 % 
0.9317314 0.9840261 

$`ACORN score`$`Confidence Intervals`$`sesMask:`ACORN scoreMissing``
    2.5 %    97.5 % 
0.4588212 1.0839709 


$`ACORN score`$`P-values`
       sesMask:`ACORN score` sesMask:`ACORN scoreMissing` 
                 0.001833997                  0.111311521 


$Pregnancies
$Pregnancies$`Variable name`
[1] "pregparous"

$Pregnancies$`Baseline group (for categorical)`
[1] "Nulliparous"

$Pregnancies$`Reference groups (for trend)`
$Pregnancies$`Reference groups (for trend)`$pregparitycnt
[1] 2

$Pregnancies$`Reference groups (for trend)`$age_at_pregdate_1_f
[1] 25


$Pregnancies$`Cox model`
Call:
coxph(formula = formula, data = temp_rf)

                                              coef exp(coef)  se(coef)      z
pregparousParous                         -0.094522  0.909808  0.047196 -2.003
pregparousMissing                        -0.898414  0.407215  0.708380 -1.268
ParousMask:`Number of births`            -0.043575  0.957361  0.024612 -1.770
ParousMask:`Number of birthsMissing`            NA        NA  0.000000     NA
ParousMask:`Age at 1st pregnancy`         0.019885  1.020084  0.004144  4.799
ParousMask:`Age at 1st pregnancyMissing` -0.496660  0.608560  0.334085 -1.487
                                                  p
pregparousParous                             0.0452
pregparousMissing                            0.2047
ParousMask:`Number of births`                0.0767
ParousMask:`Number of birthsMissing`             NA
ParousMask:`Age at 1st pregnancy`        0.00000159
ParousMask:`Age at 1st pregnancyMissing`     0.1371

Likelihood ratio test=41.36  on 5 df, p=0.00000007924
n= 104694, number of events= 3633 

$Pregnancies$Coefficients
                        pregparousParous 
                               0.9098076 
                       pregparousMissing 
                               0.4072151 
           ParousMask:`Number of births` 
                               0.9573607 
    ParousMask:`Number of birthsMissing` 
                                      NA 
       ParousMask:`Age at 1st pregnancy` 
                               1.0200837 
ParousMask:`Age at 1st pregnancyMissing` 
                               0.6085600 

$Pregnancies$`Confidence Intervals`
$Pregnancies$`Confidence Intervals`$pregparousParous
    2.5 %    97.5 % 
0.8294231 0.9979827 

$Pregnancies$`Confidence Intervals`$pregparousMissing
    2.5 %    97.5 % 
0.1015898 1.6322910 

$Pregnancies$`Confidence Intervals`$`ParousMask:`Number of births``
    2.5 %    97.5 % 
0.9122745 1.0046752 

$Pregnancies$`Confidence Intervals`$`ParousMask:`Number of birthsMissing``
 2.5 % 97.5 % 
    NA     NA 

$Pregnancies$`Confidence Intervals`$`ParousMask:`Age at 1st pregnancy``
   2.5 %   97.5 % 
1.011833 1.028402 

$Pregnancies$`Confidence Intervals`$`ParousMask:`Age at 1st pregnancyMissing``
    2.5 %    97.5 % 
0.3161768 1.1713235 


$Pregnancies$`P-values`
                        pregparousParous 
                           0.04520420258 
                       pregparousMissing 
                           0.20470290636 
           ParousMask:`Number of births` 
                           0.07665148056 
    ParousMask:`Number of birthsMissing` 
                                      NA 
       ParousMask:`Age at 1st pregnancy` 
                           0.00000159482 
ParousMask:`Age at 1st pregnancyMissing` 
                           0.13711306402 </code></pre>
</div>
</div>
</section>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p>Not displayed, as I have not implemented the code to make ‘pretty’ tables yet.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>tbls <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(analysis_results), <span class="cf">function</span>(name) {</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  a_element <span class="ot">&lt;-</span> analysis_results[[name]]</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressMessages</span>(<span class="fu">tbl_regression</span>(a_element<span class="sc">$</span><span class="st">`</span><span class="at">Cox model</span><span class="st">`</span>, <span class="at">exp=</span><span class="cn">TRUE</span>))</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co"># final_table &lt;- tbl_stack(tbls)</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co"># final_table</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>tbls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Old code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co"># coxph(Surv(fupca_start_age, c_age, event) ~ fambrca, data = dataset_surv_rf) %&gt;% </span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   tbl_regression(exp = TRUE, label = list(fambrca = "Family history")) </span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>risk_factors <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(dataset_rf_subset), <span class="st">"TCode"</span>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>cox_models <span class="ot">&lt;-</span> <span class="fu">lapply</span>(risk_factors, <span class="cf">function</span>(risk_factor) {</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">'Surv(fupca_start_age, c_age, event) ~ '</span>, risk_factor))</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coxph</span>(formula, <span class="at">data =</span> dataset_surv_rf)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>tbls <span class="ot">&lt;-</span> <span class="fu">mapply</span>(<span class="cf">function</span>(model, rf) {</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>  real_name <span class="ot">&lt;-</span> rf_config[<span class="fu">sapply</span>(rf_config, <span class="cf">function</span>(x) x<span class="sc">$</span>varname <span class="sc">==</span> rf)][[<span class="dv">1</span>]]<span class="sc">$</span>realname</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>(model, <span class="at">exp =</span> <span class="cn">TRUE</span>, <span class="at">label =</span> <span class="fu">setNames</span>(real_name, rf))</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>}, cox_models, risk_factors, <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>)</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>final_table <span class="ot">&lt;-</span> <span class="fu">tbl_stack</span>(tbls)</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>final_table</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Michael's time-splitting and analysis:</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Time splitting to allow for time-varying covariates</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a><span class="co"># split_data &lt;- survSplit(survival_data, cut = tcut, end = 'fup_years', event = 'event', id = 'TCode')</span></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Sanity checking:</span></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of person years and events per time split group</span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a><span class="co"># For pre-processing - consider lagging things (e.g., HRT by a year) - look for spike in hazard/risk re: negative HRT use.</span></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a><span class="co"># xi:stcox  i.tse i.fambrca i.bbd i.acornCAT acornTREND  /// </span></span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a><span class="co">#  i.bwCAT bwTREND i.height20CAT height20TREND10 /// </span></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a><span class="co">#  i.menarcheCAT menarcheTREND i.bmi20updateCAT bmi20updateTREND ///</span></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a><span class="co">#  i.parousCAT pageTREND pcntTREND i.physCATtotalR1 physTRENDtotalR1  ///</span></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a><span class="co">#  i.alcCAT alcTREND1   i.smokestartgrp  ///</span></span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a><span class="co">#  i.ocgrppre  i.postbmiCAT  i.hrt1 i.hrt2 i.hrt3 i.hrt4 i.hrt9 agemenoTREND2 postbmiTREND </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>
